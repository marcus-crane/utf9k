<!DOCTYPE html>
<html lang="en">
<head>
  
  
  
  
  <link rel="stylesheet" href="/littlefoot_12488593780039224145.min.54699eaea8856da92132545b99c00faedb4366ab9b50eb1b1e6856689a884ae1.css" integrity="sha256-VGmerqiFbakhMlRbmcAPrttDZqubUOsbHmhWaJqISuE=" />
  

  <title>Fixing a WSL2 VHD conversion issue | utf9k</title>
<link rel="alternate" type="text/markdown" href="https://utf9k.net/blog/wsl2-vhd-issue/index.md">
<link rel="alternate" type="text/plain" href="https://utf9k.net/blog/wsl2-vhd-issue/index.txt">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="theme-color" content="#eaebe3" media="(prefers-color-scheme: light)" />
<meta name="theme-color" content="#1f2738" media="(prefers-color-scheme: dark)" />
<meta name="author" content="Marcus Crane" />
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />

<meta name="description"
  content="One night I had a bit to drink and debugged the hell out of a WSL2 issue out of frustration" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="icon" type="image/png" href="/favicon.png" sizes="16x16">
<link rel="canonical" href="https://utf9k.net/blog/wsl2-vhd-issue/" />
<link rel="apple-touch-icon" href="/favicon.png">
<link rel="me" href="mailto:hello@utf9k.net" />
<link rel="me" href="https://mastodon.nz/@utf9k" />
<link rel="me" href="https://twitter.com/sentreh" />
<link rel="me" href="https://github.com/marcus-crane" />
<link rel="webmention" href="https://webmention.io/utf9k.net/webmention" />
<link rel="pingback" href="https://webmention.io/utf9k.net/xmlrpc" />
<meta property="og:title" content="Fixing a WSL2 VHD conversion issue" />
<meta property="og:description" content="One night I had a bit to drink and debugged the hell out of a WSL2 issue out of frustration" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://utf9k.net/blog/wsl2-vhd-issue/" /><meta property="og:image" content="https://utf9k.net/favicon.png"/><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2019-07-20T00:00:00+13:00" />
<meta property="article:modified_time" content="2023-04-16T21:59:14+12:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://utf9k.net/favicon.png"/>

<meta name="twitter:title" content="Fixing a WSL2 VHD conversion issue"/>
<meta name="twitter:description" content="One night I had a bit to drink and debugged the hell out of a WSL2 issue out of frustration"/>
<meta name="twitter:site" content="@sentreh"/>






<link rel="stylesheet" href="/css/style.min.f927dcb0e4d3990cada1be73573ac4f5fa673a75c7e0fc28d4a7ee01400aeaaf.css" integrity="sha256-+SfcsOTTmQytob5zVzrE9fpnOnXH4Pwo1KfuAUAK6q8=" />

  

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Fixing a WSL2 VHD conversion issue",
  "datePublished": "2019-07-20T00:00:00-00:00"
}
</script>


</head>
<body>
  
    <header class="navigation">
  <a href="/" id="logo">
    <img src="/favicon.png" alt="utf9k" width="16px" height="16px">
    <span>utf9k</span>
  </a>
  <nav>
    
    
    <li><a href="/blog/">Blog</a></li>
    <span>//</span>
    
    <li><a href="/projects/">Projects</a></li>
    <span>//</span>
    
    <li><a href="/about/">About</a></li>
    <span>//</span>
    
    <li><a href="/questions/">Questions</a></li>
    <span>//</span>
    
    <li><a href="/rss.xml">RSS</a></li>
    
    
  </nav>
</header>
    <div id="content">
    
<article>
  <header>
    <h1>Fixing a WSL2 VHD conversion issue</h1>
    <div id="post-meta">
      <time datetime="2019-07-20 00:00:00 &#43;1300 &#43;1300">July 20, 2019</time>  · Around 2 minutes
    </div>
  </header>
  <div id="post-body">
    


    <p>I recently started running the Windows Insider builds on my desktop so that I could play around with the new Windows Subsystem for Linux but I ran into some trouble. Before I get into the fix, here&rsquo;s a little bit of history</p>
<h2 id="the-history">
  <a class="jumplink" href="#the-history" aria-hidden="true">¶</a>
  The history
</h2><p>For the unfamiliar, it&rsquo;s a way to run Linux applications inside of a Windows environment using a lightweight VM.</p>
<p>For the familiar, you may have heard of WSL 1, which essentially translated Linux system calls into their appropriate NT kernel counterparts. The downside meant that things were kind of slow, and not everything worked as you would hope.</p>
<p>The biggest downside was perhaps USB devices, in that there were no drivers to support them. Personally, I was unable to use the Yubikey NEO I had at the time, given that <a href="https://github.com/microsoft/WSL/issues/1521">smart cards had no support</a>. Anyone using USB debug interfaces such as <a href="https://github.com/microsoft/WSL/issues/2185">JTAG</a> or <a href="https://github.com/microsoft/WSL/issues/2195">ADB</a> was out of luck too.</p>
<p>Thankfully, this should hopefully be in the past now with the <a href="https://devblogs.microsoft.com/commandline/announcing-wsl-2">announcement of WSL 2</a>, a virtual machine that&rsquo;s supposed to be so light, it&rsquo;s not like those other slow virtual machines you think of.</p>
<h2 id="the-fix">
  <a class="jumplink" href="#the-fix" aria-hidden="true">¶</a>
  The fix
</h2><p>Long story short, I dove in by following the installation instructions and hit a brick wall once I got to the second step.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">PS </span>C:\WINDOWS\system32&gt; wsl --set-version Ubuntu <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span>Conversion <span style="color:#ff79c6">in</span> progress, this may take a few minutes...
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">For</span> information on key differences with WSL <span style="color:#bd93f9">2</span> please visit https://aka.ms/wsl2
</span></span><span style="display:flex;"><span>The requested operation could not be completed due to a virtual disk system limitation.
</span></span><span style="display:flex;"><span>Virtual hard disk files must be uncompressed and unencrypted and must not be sparse.
</span></span></code></pre></div><p>Upon trying to convert my WSL distros to Version 2, they complained about a virtual disk system limitation. I actually put this on the backburner for months until coming back to it today and the fix felt dumb.</p>
<p>You&rsquo;d never know it but your WSL packages live under <code>%LOCALAPPDATA%/packages/&lt;distro title surrounded by nonsense&gt;</code>. In my case, Debian lives at <code>C:\Users\Marcus\AppData\Local\Packages\TheDebianProject.DebianGNULinux_76v4gfsz19hv4</code>. If you visit your distro&rsquo;s respective folder, you&rsquo;ll find no virtual disk image in sight.</p>
<p>The terms &ldquo;uncompressed and unencrypted&rdquo; tipped me off to check those blasted &ldquo;advanced settings&rdquo;. Under <code>Right Click -&gt; Properties -&gt; General -&gt; Advanced</code>, I spotted <code>Compress contents to save disk space</code> was ticked for some reason. Unchecking it, then rerunning the WSL 1 -&gt; 2 conversion worked as you&rsquo;d hope.</p>
<center>
  <figure>
    <img src="compressed.png" alt="A screenshot showing Windows Explorer. It is open to C:/Users/Marcus/AppData/Local/Packages. A folder is highlighted to indicate it was recently clicked on. The properties window for that folder is visible showing metadata. Overlaying the properties window is the Advanced Attributes window where a checkbox labelled &amp;lsquo;Compress contents to save disk space&amp;rsquo; is checked. The author is showing that you should uncheck that box to fix the issue described in this post."  loading="lazy" />
  </figure>
</center><p>So, if you run into this issue, have a poke around your packages and hopefully you&rsquo;ll be on your way to a nice, properly Linux-y home on Windows.</p>

  </div>
</article>

    </div>
    <div id="fullscreen"></div>
  
  
  
  
  
  
  <script defer type="text/javascript" src="/js/footnotes.1be9fd05e6f9672cdc2b4f8c9a16b96016b4941e68d5ebe04a863454f8f64122.js" integrity="sha256-G&#43;n9Beb5ZyzcK0&#43;Mmha5YBa0lB5o1evgSoY0VPj2QSI="></script>

  
  
  
  
  <script defer type="text/javascript" src="/js/image-viewer.90762074c5e8b05c4d401ecb428a34fb7215f4d42d42eb93eff0f6bda5416a6d.js" integrity="sha256-kHYgdMXosFxNQB7LQoo0&#43;3IV9NQtQuuT7/D2vaVBam0="></script>

</body>
</html>

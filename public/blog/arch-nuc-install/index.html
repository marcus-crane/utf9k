<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="theme-color" content="#a463f2" />
    <title>utf9k  | Installing Arch Linux on my Intel NUC</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.47.1" />
    <link rel="manifest" href="/manifest.json" />

    <link href="/css/tailwind.min.css" rel="stylesheet" />
    <link href="/css/style.css" rel="stylesheet" />

    <meta property="og:title" content="Installing Arch Linux on my Intel NUC" />
<meta property="og:description" content="It&rsquo;s that time again where I decide to reinstall Arch Linux and likely end up bashing my head against a wall. I have an old blog post on my Github but it could be better so this is an extended version mainly for my own future reference.
Please note that this isn&rsquo;t some guide for pros or that I expect to have the most 100% correct or efficient method of installing." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://utf9k.net/blog/arch-nuc-install/" /><meta property="article:published_time" content="2017-12-24T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2017-12-24T00:00:00&#43;00:00"/>
<meta itemprop="name" content="Installing Arch Linux on my Intel NUC">
<meta itemprop="description" content="It&rsquo;s that time again where I decide to reinstall Arch Linux and likely end up bashing my head against a wall. I have an old blog post on my Github but it could be better so this is an extended version mainly for my own future reference.
Please note that this isn&rsquo;t some guide for pros or that I expect to have the most 100% correct or efficient method of installing.">


<meta itemprop="datePublished" content="2017-12-24T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2017-12-24T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="2028">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Installing Arch Linux on my Intel NUC"/>
<meta name="twitter:description" content="It&rsquo;s that time again where I decide to reinstall Arch Linux and likely end up bashing my head against a wall. I have an old blog post on my Github but it could be better so this is an extended version mainly for my own future reference.
Please note that this isn&rsquo;t some guide for pros or that I expect to have the most 100% correct or efficient method of installing."/>
</head>
  <body>
    <div class="p-2 pt-12 font-sans leading-normal">
      <div class="px-2">
        <div class="sm:flex -mx-2 h-12">
          <div class="w-1/5 px-12">
            <a href="/" class="text-purple text-2xl font-bold">
              utf9k
            </a>
            

  <ul class="list-reset mb-8 pt-6">
  
    <li>
      <a href="/projects/">Projects</a>
    </li>
  
    <li>
      <a href="/blog/">Blog</a>
    </li>
  
    <li>
      <a href="/reviews/">Reviews</a>
    </li>
  
    <li>
      <a href="/stats/">Stats</a>
    </li>
  
    <li>
      <a href="/contact/">Contact</a>
    </li>
  
  </ul>


          </div>
          <div class="w-100 xl:w-1/2 md:w-3/5 sm:w-4/5 px-12">
            
  <h2>Installing Arch Linux on my Intel NUC</h2>
  <h3 class="pb-3 font-light text-base">Dec 24, 2017</h3>
  <div id="content">

<p>It&rsquo;s that time again where I decide to reinstall Arch Linux and likely end up bashing my head against a wall. I have an old blog post on my Github but it could be better so this is an extended version mainly for my own future reference.</p>

<p>Please note that this isn&rsquo;t some guide for pros or that I expect to have the most 100% correct or efficient method of installing. It&rsquo;s just what I know works for me.</p>

<h2 id="getting-online">Getting online</h2>

<p>As I&rsquo;m installing on an Intel NUC, I&rsquo;m going to assume you might like it run it mainly via WiFi so we&rsquo;ll start by getting online. You can do this graphically by running <code>wifi-menu</code>.</p>

<pre><code class="language-bash">wifi-menu
</code></pre>

<p>Once you&rsquo;ve set up a profile, you&rsquo;ll see a new entry when using the <code>ifconfig</code> command and you can confirm you&rsquo;re online with <code>ping archlinux.org -c 3</code>.</p>

<h2 id="setting-up-your-hard-drive">Setting up your hard drive</h2>

<p>Personally, I wouldn&rsquo;t, and probably couldn&rsquo;t (yet) install Arch Linux as a dual boot partition. That is, alongside another operating system such as Windows or macOS. You might like to and that&rsquo;s great but this isn&rsquo;t the guide for you :)</p>

<p>First, we need to see what our current devices are:</p>

<pre><code class="language-bash">fdisk -l
</code></pre>

<p>You may see a few. In my case, my hard drive has a few <code>/dev/sda{number}</code> entries and my USB has 2 <code>/dev/sdb{number}</code> entries. For the purposes of this guide, I&rsquo;ll be assuming that your hard drive is under <code>/dev/sda</code> but when installing to, say, a Macbook, I&rsquo;ve found that the hard drive can be under <code>/dev/sdb</code>.</p>

<p>My hard drive will end up looking as follows once I&rsquo;ve set it up:</p>

<table>
<thead>
<tr>
<th>Size</th>
<th>Purpose</th>
<th>Location</th>
</tr>
</thead>

<tbody>
<tr>
<td>500M</td>
<td>Boot Sector</td>
<td>/boot</td>
</tr>

<tr>
<td>20G</td>
<td>System Root</td>
<td>/</td>
</tr>

<tr>
<td>8G</td>
<td>Swap Space</td>
<td>N/A</td>
</tr>

<tr>
<td>437G</td>
<td>Home Directory</td>
<td>/home</td>
</tr>
</tbody>
</table>

<p>I&rsquo;m targeting a <a href="https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface">UEFI</a> BIOS  so we&rsquo;ll be using <a href="https://en.wikipedia.org/wiki/GUID_Partition_Table">GPT</a> for our partition table.</p>

<p>The following uses <a href="https://www.gnu.org/software/parted/manual/parted.html">Parted</a> which you may or may not be familiar with if you&rsquo;ve only use GUI installers before. Just follow along and I&rsquo;ll comment what each segment is roughly doing. From hereon in, URLs prefixed by a tilde (~) indicate resources where you can read further information if you&rsquo;re the curious sort.</p>

<p><em>NOTE</em>: The following WILL wipe your hard drive so ensure that this is what you&rsquo;d like to do and/or that you&rsquo;ve backed up everything from any currently installed OS</p>

<h2 id="partitioning">Partitioning</h2>

<pre><code class="language-bash"># Launched parted, passing our hard drive as an argument
parted /dev/sda

# Create a partition table using the GUID Partition Table (GPT) format.
# This wipes your drive(!)
mklabel gpt

# Create a 499M boot sector that will live at /boot
# ESP is short for EFI System Partition and are always formatted as FAT32
# We start at 1MiB instead of 0 because MBR/GPT both use the first block
# ~ https://unix.stackexchange.com/a/286325
# We use 550MiB as Rod Smith reports possible bugs with ESPs below 512MiB
# ~ http://www.rodsbooks.com/efi-bootloaders/principles.html
mkpart ESP fat32 1MiB 551MiB

# Set the boot flag to ON on partition number 1
# ~ https://www.gnu.org/software/parted/manual/html_node/set.html
set 1 boot on

# Create a 20G ext4 partition that will live at /
mkpart primary ext4 551MiB 20.5GiB

# Create an 8G swap partition
mkpart primary linux-swap 20.5GiB 28.5GiB

# Allocate the remaining space which will be used by users at /home/{user}
mkpart primary 28.5GiB 100%

# All done!
quit
</code></pre>

<p>Now that are partitions are set up, running <code>fdisk -l</code> again should show the following:</p>

<table>
<thead>
<tr>
<th>Device</th>
<th>Size</th>
<th>Type</th>
</tr>
</thead>

<tbody>
<tr>
<td>/dev/sda1</td>
<td>499M</td>
<td>EFI System</td>
</tr>

<tr>
<td>/dev/sda2</td>
<td>20G</td>
<td>Linux filesystem</td>
</tr>

<tr>
<td>/dev/sda3</td>
<td>8G</td>
<td>Linux swap</td>
</tr>

<tr>
<td>/dev/sda3</td>
<td>437.3G</td>
<td>Linux filesystem</td>
</tr>
</tbody>
</table>

<h2 id="making-file-systems">Making file systems</h2>

<p>We don&rsquo;t need any utilites to create our file systems, we can just do &lsquo;em straight outta the box like so:</p>

<pre><code class="language-bash"># Create a 32bit VFAT filesystem for our boot partition
# VFAT is essentially FAT32 with support for longer filenames. See below for more details.
# ~ http://wiki.linuxquestions.org/wiki/VFAT
# ~ https://unix.stackexchange.com/a/263731
mkfs.vfat -F32 /dev/sda1

# Create an ext4 filesystem for our root partition
mkfs.ext4 /dev/sda2

# Prepare a swap area
mkswap /dev/sda3

# Activate our created swap area
swapon /dev/sda3

# Create an ext4 filesystem for our home partition
mkfs.ext4 /dev/sda4
</code></pre>

<p>Now that our hard drive is completely set up, we&rsquo;re ready to mount our file systems.</p>

<h2 id="mounting-our-new-file-systems">Mounting our new file systems</h2>

<p>Just as a reminder, here&rsquo;s where we want our partitions to end up</p>

<table>
<thead>
<tr>
<th>Device</th>
<th>Format</th>
<th>Location</th>
</tr>
</thead>

<tbody>
<tr>
<td>/dev/sda1</td>
<td>ESP</td>
<td>/boot</td>
</tr>

<tr>
<td>/dev/sda2</td>
<td>ext4</td>
<td>/</td>
</tr>

<tr>
<td>/dev/sda4</td>
<td>ext4</td>
<td>/home</td>
</tr>
</tbody>
</table>

<p>Here&rsquo;s how this layout translates into mount commands:</p>

<pre><code class="language-bash"># Mount our root partition to /mnt
# NOTE: /mnt doesn't persist once we're in our bash prompt
# For example, /mnt/home becomes just /home
mount /dev/sda2 /mnt

# Create a folder which our ESP partition will be mounted to
mkdir /mnt/boot

# Mount our ESP partition to /boot
mount /dev/sda1 /mnt/boot

# Create a home folder where all of our user directories will live
mkdir /mnt/home

# Mount the home partition to /home
mount /dev/sda4 /mnt/home
</code></pre>

<p>Nice! We&rsquo;re completely done and can start to actually install and configure Arch Linux.</p>

<h2 id="installing-base-packages">Installing base packages</h2>

<p>Now we need to download and install the base packages for Arch Linux to our <code>/mnt</code> which will becomes our root (<code>/</code>) later on.</p>

<pre><code class="language-bash">pacstrap /mnt base
</code></pre>

<p>For the curious, the <code>base</code> group contains a number of default libraries and utilties you may have used such as <code>man</code>, <code>openssl</code>, <code>bash</code>, <code>iptables</code> and <code>gcc</code> to name a few.</p>

<p>You can view the <code>pacstrap</code> script itself <a href="https://git.archlinux.org/arch-install-scripts.git/tree/pacstrap.in">here</a>. I thought it would be quite longer!</p>

<p>The script also runs the <code>mkinitcpio</code> bash script which you can learn more about <a href="https://wiki.archlinux.org/index.php/mkinitcpio#Overview">here</a>.</p>

<p>This entire process may take a few minutes so feel free to read ahead while you wait.</p>

<h2 id="set-up-bash">Set up bash</h2>

<p>With Arch Linux installed, we can finally move off of our live USB and start a bash process to set up our freshly initialised system after 2 more quick steps</p>

<p>Step 1 is generating a <a href="http://www.linfo.org/etc_fstab.html">file systems table</a>, referred to as <code>fstab</code> going forward. This is done so that all devices (/dev/sdaX) specificied in the file are mounted automatically on startup.</p>

<pre><code class="language-bash">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
</code></pre>

<p>The <code>-U</code> flag denotes that we want to identify our devices using <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUIDs</a>, instead of labels, as noted <a href="https://github.com/falconindy/arch-install-scripts/blob/master/genfstab.in#L86">here</a>.</p>

<p>Step 2 is even quicker being shorter</p>

<pre><code class="language-bash">arch-chroot /mnt
</code></pre>

<p><code>arch-chroot</code>, seen <a href="https://github.com/falconindy/arch-install-scripts/blob/master/arch-chroot.in">here</a> changes the root directory to, well, <code>/</code> which is our new root directory. As we&rsquo;re still on the live USB, we specify it as <code>/mnt</code> instead.</p>

<p><code>arch-chroot</code> is also able to take some flags following the root partition such as <code>arch-chroot /mnt /bin/bash</code>. It&rsquo;s worth noting that the preceeding example is actually fairly pointless seeing as <code>arch-chroot</code> already defaults to <code>bash</code> anyway.</p>

<p>Huzzah! We&rsquo;re finally in our new system but will it boot? Not quite yet and we&rsquo;ve still a lot to set up so let&rsquo;s carry on.</p>

<h2 id="updates-and-other-dependencies-optional">Updates and other dependencies (optional)</h2>

<p>At this point, I like to run a system upgrade using <code>pacman -Syu</code> just in case. As we&rsquo;ve just pulled our dependencies minutes ago, it&rsquo;ll likely find nothing but I reckon it feels good, haha.</p>

<p>I also need some extra bits and pieces for later at this point. We couldn&rsquo;t have fetched these earlier as trying to run <code>pacman</code>, the Arch Linux package manager, from the live USB would attempt to install to the USB itself and error out.</p>

<p>I need the following bits:</p>

<table>
<thead>
<tr>
<th>Package</th>
<th>Purpose</th>
</tr>
</thead>

<tbody>
<tr>
<td><a href="http://invisible-island.net/dialog/">dialog</a></td>
<td>A library for console-based UIs like <code>wifi-menu</code></td>
</tr>

<tr>
<td><a href="https://downloadcenter.intel.com/search?keyword=microcode+data">intel-ucode</a></td>
<td>Micro-code updates for Intel CPUs</td>
</tr>

<tr>
<td><a href="https://w1.fi/wpa_supplicant/">wpa_supplicant</a></td>
<td>Used to connect to wireless networks (put simply)</td>
</tr>
</tbody>
</table>

<p>That should be everything for now. The other bits (<code>netctl</code> and <code>dhcpcd</code>) were already installed as part of the <code>base</code> group from earlier. If you&rsquo;re using Ethernet, you can basically skip this entire step hence why it&rsquo;s marked as optional.</p>

<p>Honestly, we don&rsquo;t really need <code>dialog</code> as we could just use <code>netctl</code> directly but I find it more user friendly and I&rsquo;m not a masochist, haha.</p>

<p>You might as well also enable <code>dhcpcd</code> if you need it for ethernet with <code>systemctl enable dhcpcd</code>.</p>

<h2 id="generating-locale">Generating locale</h2>

<p>Popular software often ships in a number of languages but in order to show the correct language, currency and so on, it needs to know where you live. We achieve this by generating and setting a locale.</p>

<p>To do so, edit <code>/etc/locale.gen</code> and uncomment your respective locale. In short, the format is {language_country code}.{character encoding}. If in doubt, just opt for <code>utf-8</code>. As an example, I&rsquo;m in New Zealand so I uncomment the line <code>#en_NZ.UTF-8 UTF-8</code>. I just use <code>nano</code> but if you prefer, this would be an alright time to run <code>pacman -S vim</code>.</p>

<p>Once you&rsquo;ve done that, you&rsquo;ll need to generate the locale files and export your language to your environment</p>

<pre><code class="language-bash">locale-gen
export LANG={xx}_{yy}.UTF-8
</code></pre>

<p>If done successfully, <code>echo $LANG</code> will display your locale.</p>

<p>For reference, the actual <code>locale-gen</code> script can be seen <a href="https://sourceware.org/git/?p=glibc.git;a=blob;f=localedata/gen-locale.sh;h=39f1475cbc45faaae32728dbfd7cce282c3cdb05;hb=HEAD">here</a> as part of <a href="https://sourceware.org/git/?p=glibc.git;a=summary">glibc</a>, the GNU implementation of the C standard library. I always wondered where it was from!</p>

<h2 id="timezone">Timezone</h2>

<p>Selecting our timezone is fairly straightforward thanks to an interactive program called <code>tzselect</code>. Running it will show a list of continents and oceans. Selecting one will drill down to display countries.</p>

<p>Once you&rsquo;ve confirmed the output, it will mention appending the timezone to a file. Instead, we want to symlink that timezone to a file. In my case, the timezone is <code>Pacific/Auckland</code> but of course, you&rsquo;ll want to input your respective timezone instead.</p>

<pre><code class="language-bash">ln -s /usr/share/zoneinfo/Pacific/Auckland /etc/localtime
</code></pre>

<h2 id="setting-hardware-clock">Setting hardware clock</h2>

<p>The last of our locale related setups is configuring the system clock. To do that, we&rsquo;ll tell our hardware clock to set the system time using the <code>--hctosys</code> option. You can read more about <code>hwclock</code> and how it differs from system time <a href="https://linux.die.net/man/8/hwclock">here</a></p>

<pre><code class="language-bash">hwclock --systohc
</code></pre>

<h2 id="hostname-setup">Hostname setup</h2>

<p>We like life to be simple (but no simpler) and giving our computer/server a unique name is an important part of that process. For this bit, let&rsquo;s assume we want to name our system <code>weinerdog</code> because it sounds silly.</p>

<pre><code class="language-bash">echo weinerdog &gt; /etc/hostname
</code></pre>

<p>Oh, that was easy. We also need to tell our system that <code>weinerdog</code> is an alias for <code>127.0.0.1</code>, just like <code>localhost</code> is. We could fire up our favourite editor but it&rsquo;s likely <code>/etc/hosts</code> is empty so just do the following:</p>

<pre><code class="language-bash">echo 127.0.0.1 localhost weinerdog &gt; /etc/hosts
</code></pre>

<p>How quick was that, huh?</p>

<h2 id="set-a-root-password">Set a root password</h2>

<p>We&rsquo;ll be using this password to login, which I sometimes forget. It <em>bashould</em> be different than the password for the user account we&rsquo;ll be making soon but I&rsquo;d be lying if I said I have a super secure password. You have bigger problems if you think this writeup will give you top notch security anyway. I&rsquo;m just here for a usable system!</p>

<pre><code class="language-bash">passwd
</code></pre>

<p>Just type in your password twice. Not much more to it than that.</p>

<h2 id="installing-a-boot-manager">Installing a boot manager</h2>

<p>We&rsquo;ll be using <code>systemd-boot</code> as our EFI boot manager. I couldn&rsquo;t tell you anything about it other than it works and that&rsquo;s good enough.</p>

<pre><code class="language-bash">bootctl --path=/boot install
</code></pre>

<p>The above command copies the <code>systemd-boot</code> binary to our EFI System Partition (<code>/boot</code>) and adds it as the default EFI application to be loaded as stated <a href="https://wiki.archlinux.org/index.php/systemd-boot#EFI_boot">here</a>.</p>

<h2 id="configuring-the-boot-manager">Configuring the boot manager</h2>

<p>Now that we have a boot manager, we need to tell it what to boot exactly. We&rsquo;ll create a new <code>arch.conf</code> entry using <code>nano</code>:</p>

<pre><code class="language-bash">nano /boot/loader/entries/arch.conf
</code></pre>

<p>and enter the following</p>

<pre><code class="language-bash">title Arch Linux
linux /vmlinuz-linux
initrd /intel-ucode.img
initrd /initramfs-linux.img
options root=/dev/sda2 rw elevator=deadline quiet splash resume=/dev/sda3 nmi_watchdog=0
</code></pre>

<p><em>NOTE</em>: The line <code>initrd /intel-ucode.img</code> <em>ONLY</em> applies if you installed the <code>intel-ucode</code> package from earlier which anyone with an Intel CPU should do.</p>

<p>As for the options, I couldn&rsquo;t say if you need, or don&rsquo;t need, any of them but it&rsquo;s worked fine for me so far. I&rsquo;ll probably read up on them in depth shortly and update this post as required.</p>

<p>Once that&rsquo;s created, set it as the default configuration:</p>

<pre><code class="language-bash">echo &quot;default arch&quot; &gt; /boot/loader/loader.conf
</code></pre>

<p>and now you&rsquo;re ready to reboot into a nicely working system!</p>

<pre><code class="language-bash">exit
reboot
</code></pre>

<p>I&rsquo;ve still got a lot to learn about Arch Linux but so far, the above setup has worked well for me.</p>

<p>There&rsquo;s still more that goes into a system but this is enough to get past the pesky initial setup which gave me hours upon hours of grief as a beginner, which I still am essentially.</p>
</div>

          </div>
        </div>
      </div>
    </div>
  </body>
</html>

var k=Object.defineProperty;var o=(e,t)=>k(e,"name",{value:t,configurable:!0});var f=document.querySelector("#liveplayer"),s=document.querySelector("#action"),d=document.querySelector("#cover"),y=document.querySelector("#title"),$=document.querySelector("#subtitle"),p=document.querySelector("#elapsed"),_=document.querySelector("#duration"),h=document.querySelector("#progress"),a=document.querySelector("#rotating-border"),g="manga",m="gaming",b="episode",T="movie",v="track",A="\u{1F579} I'm currently playing",V="\u{1F579} I was recently playing",q="\u{1F3A7} I'm currently listening to",C="\u{1F3A7} I was recently listening to",M="\u{1F4FA} I'm currently watching",P="\u{1F4FA} I was recently watching",H="\u{1F4DA} I'm currently reading",N="\u{1F4DA} I was recently reading",E={MANGA:!1,GAMING:!1,EPISODE:!0,MOVIE:!0,TRACK:!0};fetch("https://gunslinger.utf9k.net/api/v3/playing").then(e=>e.json()).then(e=>w(e)).then(e=>x()).catch(e=>console.error(`Failed to initialise player state: ${e}`));var U=new EventSource("https://gunslinger.utf9k.net/events?stream=playback");U.onmessage=function(e){let t=JSON.parse(e.data);if(t.started_at<0)throw"Encountered a bug so we won't render the live player";let n=y.innerText;w(t),(!E[t.category]||t.is_active)&&t.title!==n&&x()};function I(e){return e.includes(" - ")?`Chapters ${e.replace("-","through")}`:`Chapter ${e}`}o(I,"formatMangaTitle");function u(e){let t=new Date(Date.UTC(0,0,0,0,0,0,e)),n=[t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds()];return t.getUTCHours()===0&&n.shift(),n.map(r=>String(r).padStart(2,"0")).join(":")}o(u,"formatMsToHumanTimestamp");function w(e){clearInterval(window.currentInterval);let t=e.elapsed_ms,n=e.duration_ms,r=!1;switch(a.className="rotating-border-hidden",e.category){case g:e.title=I(e.title),e.is_active?s.innerText=H:s.innerText=N;break;case m:e.is_active?s.innerText=A:s.innerText=V;break;case b:case T:e.is_active?(s.innerText=M,r=!0):s.innerText=P;break;case v:e.is_active?(s.innerText=q,r=!0):s.innerText=C;break;default:break}f.className="transition-opacity duration-1000",e.dominant_colours&&e.is_active&&(a.className="rotating-border-hidden",a.style="",G(e.dominant_colours),a.className=""),r?(p.innerText=u(t),_.innerText=u(n),h.style.display="block"):h.style.display="none",y.innerText=e.title,$.innerText=e.subtitle,d.src="https://gunslinger.utf9k.net"+e.image,d.alt=`Cover art for the ${e.category} ${e.title} by ${e.subtitle}`,f.style.opacity=1,r&&(window.currentInterval=setInterval(function(){t<=n&&(t+=1e3),p.innerText=u(t),t>=n&&(clearInterval(window.currentInterval),t=n,console.log("The track should have finished. Refreshing shortly!"))},1e3))}o(w,"renderLivePlayer");function G(e){let t=[...e,...e,...e],r=1/(e.length*3),i=0,l="conic-gradient(";for(let S of t)l+=`${S} ${i}turn ${i+r}turn,`,i+=r;l+=")",l=l.replace(",)",")"),a.style.setProperty("--border-bg",l)}o(G,"buildAnimatedBorder");var c=document.querySelector("#played-items");function x(){fetch("https://gunslinger.utf9k.net/api/v3/history").then(e=>e.json()).then(e=>j(e)).catch(e=>console.error(`Failed to initialise player history: ${e}`))}o(x,"fetchHistory");function j(e){c.textContent.trim()!==""&&(c.textContent="");let t=0;for(let n of e){if(n.category===g&&(n.title=I(n.title)),n.title===y.innerText&&t==0)continue;let r=10;t===0&&(r=0);let i="";switch(n.category){case m:i="\u{1F579}";break;case b:i="\u{1F4FA}";break;case T:i="\u{1F3AC}";break;case v:i="\u{1F3A7}";break;case g:i="\u{1F4DA}";break;default:i=""}c.insertAdjacentHTML("beforeend",`<li class="history-entry" style="font-size: ${r}px;">${i} ${n.title} - ${n.subtitle}</li>`),t+=1}t!==0&&(setTimeout(()=>c.children[0].style="font-size: 10px;",1e3),!(t<6)&&setTimeout(()=>c.children[c.children.length-1].style="font-size: 0px;",3e3))}o(j,"renderHistory");

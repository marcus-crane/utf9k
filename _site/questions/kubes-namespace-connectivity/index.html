<!doctype html>
<html lang="en">
  <head>
    <title>utf9k</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="theme-color" content="#eaebe3" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1f2738" media="(prefers-color-scheme: dark)" />
    <meta name="author" content="Marcus Crane" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" href="/favicon.png" sizes="16x16" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    <link rel="me" href="mailto:hello@utf9k.net" />
    <link rel="me" href="https://mastodon.nz/@utf9k" />
    <link rel="me" href="https://twitter.com/sentreh" />
    <link rel="me" href="https://github.com/marcus-crane" />
    <link rel="webmention" href="https://webmention.io/utf9k.net/webmention" />
    <link rel="pingback" href="https://webmention.io/utf9k.net/xmlrpc" />
    <link rel="stylesheet" href="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.css" />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <header class="navigation">
      <a href="/" id="logo">
        <img src="/favicon.png" alt="utf9k" width="16px" height="16px" />
        <span>utf9k</span>
      </a>
      <nav>
        <li><a href="/blog/">Blog</a></li>
        <span>//</span>
        <li><a href="/projects/">Projects</a></li>
        <span>//</span>
        <li><a href="/about/">About</a></li>
        <span>//</span>
        <li><a href="/questions/">Questions</a></li>
        <span>//</span>
        <li><a href="/rss.xml">RSS</a></li>
      </nav>
    </header>
    <div id="content">
      <article>
        <header>
          <h1>How can I test connectivity within my Kube namespace?</h1>
        </header>
        <div id="post-body">
          <p>
            Often times, you might want to test connectivity to a container but without doing so from within the
            container itself. You could just into a neighbouring pod but it may not have networking tools (ie tools) or
            even potentially network connectively if there's a
            <a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">network policy</a> in
            the mix.
          </p>
          <p>
            A quick way to deploy a curl container has been shared before
            <a
              href="https://kubernetes.io/docs/concepts/services-networking/connect-applications-service/#securing-the-service"
              >in the Kubernetes docs</a
            >
            and it looks like this:
          </p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="bash"
              data-theme="dark"
            ><code data-language="bash" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #3E8FB0">></span><span style="color: #E0DEF4"> kubectl run curl --image=radial/busyboxplus:curl -i --tty</span></span>
<span data-line=""><span style="color: #EA9A97">Unable</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">to</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">use</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">a</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">TTY</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">-</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">container</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">curl</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">did</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">not</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">allocate</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">one</span></span>
<span data-line=""><span style="color: #EA9A97">If</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">you</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">don't see a command prompt, try pressing enter.</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="bash"
              data-theme="light"
            ><code data-language="bash" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #286983">></span><span style="color: #575279"> kubectl run curl --image=radial/busyboxplus:curl -i --tty</span></span>
<span data-line=""><span style="color: #D7827E">Unable</span><span style="color: #575279"> </span><span style="color: #EA9D34">to</span><span style="color: #575279"> </span><span style="color: #EA9D34">use</span><span style="color: #575279"> </span><span style="color: #EA9D34">a</span><span style="color: #575279"> </span><span style="color: #EA9D34">TTY</span><span style="color: #575279"> </span><span style="color: #EA9D34">-</span><span style="color: #575279"> </span><span style="color: #EA9D34">container</span><span style="color: #575279"> </span><span style="color: #EA9D34">curl</span><span style="color: #575279"> </span><span style="color: #EA9D34">did</span><span style="color: #575279"> </span><span style="color: #EA9D34">not</span><span style="color: #575279"> </span><span style="color: #EA9D34">allocate</span><span style="color: #575279"> </span><span style="color: #EA9D34">one</span></span>
<span data-line=""><span style="color: #D7827E">If</span><span style="color: #575279"> </span><span style="color: #EA9D34">you</span><span style="color: #575279"> </span><span style="color: #EA9D34">don't see a command prompt, try pressing enter.</span></span></code></pre>
          </div>
          <p>
            I think the output looks something like that but this is a bit more involved as my work makes use of
            <a href="https://docs.microsoft.com/en-us/azure/governance/policy/concepts/policy-for-kubernetes"
              >policies</a
            >
            in our cluster.
          </p>
          <p>
            Now normally I just keep a file called <code>curl-debug.yml</code> sitting around my hard drive and deploy
            it using <code>kubectl apply -f curl-debug.yml</code> but you can also deploy it inline using a hideously
            log container override.
          </p>
          <p>
            You may need more (or less) override fields depending on eg; if your network policy only allows pods with
            certain annotations or metadata to connect to what you're testing.
          </p>
          <p>
            An unprivileged curl pod would look something like this. Note that I've removed
            <code>-i --rm --tty</code> as it always seems buggy to me and I much prefer to just manually run
            <code>kubectl exec -it curl -- sh</code> than have my terminal hanging.
          </p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="bash"
              data-theme="dark"
            ><code data-language="bash" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #3E8FB0">></span><span style="color: #E0DEF4"> kubectl run curl --image=radial/busyboxplus:curl --overrides=</span><span style="color: #F6C177">'{ "spec": { "securityContext": { "runAsUser": 1000, "runAsGroup": 1000, "seccompProfile": { "type": "RuntimeDefault" }}, "containers": [{ "name": "curl", "image": "radial/busyboxplus:curl", "command": [ "/bin/sh", "-c", "--" ], "args": [ "while true; do sleep 30; done; " ], "securityContext": { "runAsNonRoot": true, "allowPrivilegeEscalation": false }}]}}</span></span>
<span data-line=""><span style="color: #F6C177">pod/curl created</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="bash"
              data-theme="light"
            ><code data-language="bash" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #286983">></span><span style="color: #575279"> kubectl run curl --image=radial/busyboxplus:curl --overrides=</span><span style="color: #EA9D34">'{ "spec": { "securityContext": { "runAsUser": 1000, "runAsGroup": 1000, "seccompProfile": { "type": "RuntimeDefault" }}, "containers": [{ "name": "curl", "image": "radial/busyboxplus:curl", "command": [ "/bin/sh", "-c", "--" ], "args": [ "while true; do sleep 30; done; " ], "securityContext": { "runAsNonRoot": true, "allowPrivilegeEscalation": false }}]}}</span></span>
<span data-line=""><span style="color: #EA9D34">pod/curl created</span></span></code></pre>
          </div>
          <p>and for those who don't love huge eyesores, here's the contents of the pod spec I alluded to earlier:</p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="yaml"
              data-theme="dark"
            ><code data-language="yaml" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #9CCFD8">apiVersion</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">v1</span></span>
<span data-line=""><span style="color: #9CCFD8">kind</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Pod</span></span>
<span data-line=""><span style="color: #9CCFD8">metadata</span><span style="color: #908CAA">:</span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #9CCFD8">name</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">"curl"</span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #9CCFD8">labels</span><span style="color: #908CAA">:</span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #9CCFD8">app</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">"my-cool-app"</span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #9CCFD8">service</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">"some-other-identifier"</span></span>
<span data-line=""><span style="color: #9CCFD8">spec</span><span style="color: #908CAA">:</span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #9CCFD8">securityContext</span><span style="color: #908CAA">:</span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #9CCFD8">runAsUser</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">1000</span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #9CCFD8">runAsGroup</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">1000</span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #9CCFD8">seccompProfile</span><span style="color: #908CAA">:</span></span>
<span data-line=""><span style="color: #E0DEF4">      </span><span style="color: #9CCFD8">type</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">RuntimeDefault</span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #9CCFD8">containers</span><span style="color: #908CAA">:</span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #908CAA">-</span><span style="color: #E0DEF4"> </span><span style="color: #9CCFD8">name</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">"curl"</span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #9CCFD8">image</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">"radial/busyboxplus:curl"</span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #9CCFD8">command</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #908CAA">[</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">"/bin/sh"</span><span style="color: #908CAA">,</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">"-c"</span><span style="color: #908CAA">,</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">"--"</span><span style="color: #E0DEF4"> </span><span style="color: #908CAA">]</span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #9CCFD8">args</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #908CAA">[</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">"while true; do sleep 30; done;"</span><span style="color: #E0DEF4"> </span><span style="color: #908CAA">]</span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #9CCFD8">securityContext</span><span style="color: #908CAA">:</span></span>
<span data-line=""><span style="color: #E0DEF4">      </span><span style="color: #9CCFD8">runAsNonRoot</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">true</span></span>
<span data-line=""><span style="color: #E0DEF4">      </span><span style="color: #9CCFD8">allowPrivilegeEscalation</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">false</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="yaml"
              data-theme="light"
            ><code data-language="yaml" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #56949F">apiVersion</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">v1</span></span>
<span data-line=""><span style="color: #56949F">kind</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">Pod</span></span>
<span data-line=""><span style="color: #56949F">metadata</span><span style="color: #797593">:</span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #56949F">name</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">"curl"</span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #56949F">labels</span><span style="color: #797593">:</span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #56949F">app</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">"my-cool-app"</span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #56949F">service</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">"some-other-identifier"</span></span>
<span data-line=""><span style="color: #56949F">spec</span><span style="color: #797593">:</span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #56949F">securityContext</span><span style="color: #797593">:</span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #56949F">runAsUser</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #D7827E">1000</span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #56949F">runAsGroup</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #D7827E">1000</span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #56949F">seccompProfile</span><span style="color: #797593">:</span></span>
<span data-line=""><span style="color: #575279">      </span><span style="color: #56949F">type</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">RuntimeDefault</span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #56949F">containers</span><span style="color: #797593">:</span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #797593">-</span><span style="color: #575279"> </span><span style="color: #56949F">name</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">"curl"</span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #56949F">image</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">"radial/busyboxplus:curl"</span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #56949F">command</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #797593">[</span><span style="color: #575279"> </span><span style="color: #EA9D34">"/bin/sh"</span><span style="color: #797593">,</span><span style="color: #575279"> </span><span style="color: #EA9D34">"-c"</span><span style="color: #797593">,</span><span style="color: #575279"> </span><span style="color: #EA9D34">"--"</span><span style="color: #575279"> </span><span style="color: #797593">]</span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #56949F">args</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #797593">[</span><span style="color: #575279"> </span><span style="color: #EA9D34">"while true; do sleep 30; done;"</span><span style="color: #575279"> </span><span style="color: #797593">]</span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #56949F">securityContext</span><span style="color: #797593">:</span></span>
<span data-line=""><span style="color: #575279">      </span><span style="color: #56949F">runAsNonRoot</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #D7827E">true</span></span>
<span data-line=""><span style="color: #575279">      </span><span style="color: #56949F">allowPrivilegeEscalation</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #D7827E">false</span></span></code></pre>
          </div>
          <p>
            Ah right, the actual point of the question. Once you have curl running, and you're inside the container, you
            can then use <code>curl</code> to test out the connectivity of things.
          </p>
          <p>
            For example, earlier today I was moving a container to a new cluster and it was using the URL that the
            ingress was listening to. Let's use <code>https://sports.example.com</code> in this case and say that the
            service was called <code>sports</code>.
          </p>
          <p>
            The ingress URL changed from being internally accessible to publically accessable, although behind an OAuth2
            proxy of course.
          </p>
          <p>I noticed this change by doing the following:</p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="bash"
              data-theme="dark"
            ><code data-language="bash" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #3E8FB0">></span><span style="color: #E0DEF4"> curl --head --location http://sports</span></span>
<span data-line=""><span style="color: #EA9A97">HTTP/1.1</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">200</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">OK</span></span>
<span data-line=""><span style="color: #EA9A97">Server:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">nginx</span></span>
<span data-line=""><span style="color: #908CAA">[</span><span style="color: #E0DEF4">...</span><span style="color: #908CAA">]</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="bash"
              data-theme="light"
            ><code data-language="bash" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #286983">></span><span style="color: #575279"> curl --head --location http://sports</span></span>
<span data-line=""><span style="color: #D7827E">HTTP/1.1</span><span style="color: #575279"> </span><span style="color: #D7827E">200</span><span style="color: #575279"> </span><span style="color: #EA9D34">OK</span></span>
<span data-line=""><span style="color: #D7827E">Server:</span><span style="color: #575279"> </span><span style="color: #EA9D34">nginx</span></span>
<span data-line=""><span style="color: #797593">[</span><span style="color: #575279">...</span><span style="color: #797593">]</span></span></code></pre>
          </div>
          <p>Ok, it resolves the internal service perfectly fine. How about the public one?</p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="bash"
              data-theme="dark"
            ><code data-language="bash" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #3E8FB0">></span><span style="color: #E0DEF4"> curl --head --location https://sports.example.com</span></span>
<span data-line=""><span style="color: #EA9A97">HTTP/1.1</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">302</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Moved</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Temporarily</span></span>
<span data-line=""><span style="color: #EA9A97">Location:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">https://example.com/_oauth2/start?rd=https://sports.example.com</span></span>
<span data-line=""><span style="color: #908CAA">[</span><span style="color: #E0DEF4">...</span><span style="color: #908CAA">]</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #EA9A97">HTTP/1.1</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">302</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Found</span></span>
<span data-line=""><span style="color: #EA9A97">Location:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">https://login.microsoftonline.com/common/oauth2/authorize?a_very_long_string</span></span>
<span data-line=""><span style="color: #908CAA">[</span><span style="color: #E0DEF4">...</span><span style="color: #908CAA">]</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #EA9A97">HTTP/1.1</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">200</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">OK</span></span>
<span data-line=""><span style="color: #EA9A97">Content-Length:</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">186288</span></span>
<span data-line=""><span style="color: #908CAA">[</span><span style="color: #E0DEF4">...</span><span style="color: #908CAA">]</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="bash"
              data-theme="light"
            ><code data-language="bash" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #286983">></span><span style="color: #575279"> curl --head --location https://sports.example.com</span></span>
<span data-line=""><span style="color: #D7827E">HTTP/1.1</span><span style="color: #575279"> </span><span style="color: #D7827E">302</span><span style="color: #575279"> </span><span style="color: #EA9D34">Moved</span><span style="color: #575279"> </span><span style="color: #EA9D34">Temporarily</span></span>
<span data-line=""><span style="color: #D7827E">Location:</span><span style="color: #575279"> </span><span style="color: #EA9D34">https://example.com/_oauth2/start?rd=https://sports.example.com</span></span>
<span data-line=""><span style="color: #797593">[</span><span style="color: #575279">...</span><span style="color: #797593">]</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #D7827E">HTTP/1.1</span><span style="color: #575279"> </span><span style="color: #D7827E">302</span><span style="color: #575279"> </span><span style="color: #EA9D34">Found</span></span>
<span data-line=""><span style="color: #D7827E">Location:</span><span style="color: #575279"> </span><span style="color: #EA9D34">https://login.microsoftonline.com/common/oauth2/authorize?a_very_long_string</span></span>
<span data-line=""><span style="color: #797593">[</span><span style="color: #575279">...</span><span style="color: #797593">]</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #D7827E">HTTP/1.1</span><span style="color: #575279"> </span><span style="color: #D7827E">200</span><span style="color: #575279"> </span><span style="color: #EA9D34">OK</span></span>
<span data-line=""><span style="color: #D7827E">Content-Length:</span><span style="color: #575279"> </span><span style="color: #D7827E">186288</span></span>
<span data-line=""><span style="color: #797593">[</span><span style="color: #575279">...</span><span style="color: #797593">]</span></span></code></pre>
          </div>
          <p>
            Now, I don't even have to look at the payload to infer that we probably just hit an OAuth2 login page and
            that's exactly what was happening.
          </p>
          <p>
            In the previous cluster, we were using internal links to the external OAuth proxy is never involved.
            Admittedly, this was rationalised as "DNS just magically knows to resolve the request to the service right
            next door" and perhaps this is true but maybe not!
          </p>
          <p>Anyway, a third case that you might run into is the following:</p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="bash"
              data-theme="dark"
            ><code data-language="bash" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #3E8FB0">></span><span style="color: #E0DEF4"> curl --head --location http://something</span></span>
<span data-line=""><span style="color: #908CAA; font-style: italic">#</span><span style="color: #6E6A86; font-style: italic"> the command just sits with no output forever!</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="bash"
              data-theme="light"
            ><code data-language="bash" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #286983">></span><span style="color: #575279"> curl --head --location http://something</span></span>
<span data-line=""><span style="color: #797593; font-style: italic">#</span><span style="color: #9893A5; font-style: italic"> the command just sits with no output forever!</span></span></code></pre>
          </div>
          <p>
            If you check my <code>curl-debug.yaml</code>, I have specific labels that the network policy looks for.
            Because this curl pod is missing them, it can't make any requests.
          </p>
          <p>
            This could be anything from protocol (TCP/UDP), port number, whitelisted namespaces, whitelisted resources
            and so on. If you have this problem, either check your various log messages for reference to a required
            policy or check for an existing one that needs to be updated.
          </p>
          <p>
            Doing a search for "kind: NetworkPolicy" should help narrow down which files are relevant and/or if they
            even exist in the first place.
          </p>
          <p>Happy debugging!</p>
        </div>
      </article>

      <script src="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.js" type="text/javascript"></script>
      <script type="text/javascript">
        littlefoot.littlefoot(); // Pass any littlefoot settings here.
      </script>
    </div>
    <div id="fullscreen"></div>
    <script type="module">
      import "/js/image-viewer.js";
    </script>
  </body>
</html>

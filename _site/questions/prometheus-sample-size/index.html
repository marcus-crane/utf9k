<!doctype html>
<html lang="en">
  <head>
    <title>utf9k</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="theme-color" content="#eaebe3" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1f2738" media="(prefers-color-scheme: dark)" />
    <meta name="author" content="Marcus Crane" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" href="/favicon.png" sizes="16x16" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    <link rel="me" href="mailto:hello@utf9k.net" />
    <link rel="me" href="https://mastodon.nz/@utf9k" />
    <link rel="me" href="https://twitter.com/sentreh" />
    <link rel="me" href="https://github.com/marcus-crane" />
    <link rel="webmention" href="https://webmention.io/utf9k.net/webmention" />
    <link rel="pingback" href="https://webmention.io/utf9k.net/xmlrpc" />
    <link rel="stylesheet" href="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.css" />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <header class="navigation">
      <a href="/" id="logo">
        <img src="/favicon.png" alt="utf9k" width="16px" height="16px" />
        <span>utf9k</span>
      </a>
      <nav>
        <li><a href="/blog/">Blog</a></li>
        <span>//</span>
        <li><a href="/projects/">Projects</a></li>
        <span>//</span>
        <li><a href="/about/">About</a></li>
        <span>//</span>
        <li><a href="/questions/">Questions</a></li>
        <span>//</span>
        <li><a href="/rss.xml">RSS</a></li>
      </nav>
    </header>
    <div id="content">
      <article>
        <header>
          <h1>How large is a single Prometheus sample?</h1>
        </header>
        <div id="post-body">
          <p>
            According to the
            <a href="https://prometheus.io/docs/prometheus/latest/storage/#operational-aspects">Storage</a> part of the
            Prometheus documentation, a single sample is somewhere between 1 - 2 bytes.
          </p>
          <p>You can roughly calculate how much storage you'll need with the following formulae:</p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="text"
              data-theme="dark"
            ><code data-language="text" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #e0def4">disk_space = retention_time_in_seconds * samples_ingested_per_second * 2 bytes (take the upper to be safe)</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="text"
              data-theme="light"
            ><code data-language="text" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #575279">disk_space = retention_time_in_seconds * samples_ingested_per_second * 2 bytes (take the upper to be safe)</span></span></code></pre>
          </div>
          <p>
            By that logic, if we were ingesting 4000 samples per second and we were retaining them for 15 days (the
            default), it would look something like this:
          </p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="text"
              data-theme="dark"
            ><code data-language="text" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #e0def4">disk_space = 1296000 * 4000 * 2</span></span>
<span data-line=""><span style="color: #e0def4">disk_space // 10368000000 bytes</span></span>
<span data-line=""><span style="color: #e0def4">disk_space in gigabytes // 10.37 gigabytes</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="text"
              data-theme="light"
            ><code data-language="text" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #575279">disk_space = 1296000 * 4000 * 2</span></span>
<span data-line=""><span style="color: #575279">disk_space // 10368000000 bytes</span></span>
<span data-line=""><span style="color: #575279">disk_space in gigabytes // 10.37 gigabytes</span></span></code></pre>
          </div>
          <p>
            Given this, you can see the levers you have are decreasing the amount of sampling going on, reducing the
            amount of time samples are retained for or simply buying more disk space as you go on.
          </p>
          <p>
            Remember as well that we took the high end of the estimation and it could be as low as 5.185 if we're
            extremely lucky on compression and/or presumably we have next to no labels on each sample.
          </p>
          <p>
            You would also need to factor in many other things such as the
            <a href="https://www.robustperception.io/how-much-space-does-the-wal-take-up">write-ahead log</a> but I
            don't pretend to know what any of these things are.
          </p>
          <p>I just use Prometheus! I don't actually maintain a cluster or anything like that.</p>
        </div>
      </article>

      <script src="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.js" type="text/javascript"></script>
      <script type="text/javascript">
        littlefoot.littlefoot(); // Pass any littlefoot settings here.
      </script>
    </div>
    <div id="fullscreen"></div>
    <script type="module">
      import "/js/image-viewer.js";
    </script>
  </body>
</html>

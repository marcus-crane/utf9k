<!doctype html>
<html lang="en">
  <head>
    <title>utf9k</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="theme-color" content="#eaebe3" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1f2738" media="(prefers-color-scheme: dark)" />
    <meta name="author" content="Marcus Crane" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" href="/favicon.png" sizes="16x16" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    <link rel="me" href="mailto:hello@utf9k.net" />
    <link rel="me" href="https://mastodon.nz/@utf9k" />
    <link rel="me" href="https://twitter.com/sentreh" />
    <link rel="me" href="https://github.com/marcus-crane" />
    <link rel="webmention" href="https://webmention.io/utf9k.net/webmention" />
    <link rel="pingback" href="https://webmention.io/utf9k.net/xmlrpc" />
    <link rel="stylesheet" href="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.css" />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <header class="navigation">
      <a href="/" id="logo">
        <img src="/favicon.png" alt="utf9k" width="16px" height="16px" />
        <span>utf9k</span>
      </a>
      <nav>
        <li><a href="/blog/">Blog</a></li>
        <span>//</span>
        <li><a href="/projects/">Projects</a></li>
        <span>//</span>
        <li><a href="/about/">About</a></li>
        <span>//</span>
        <li><a href="/questions/">Questions</a></li>
        <span>//</span>
        <li><a href="/rss.xml">RSS</a></li>
      </nav>
    </header>
    <div id="content">
      <article>
        <header>
          <h1>Using Fastmail with CalDAV libraries</h1>

          <div id="post-meta">
            <time datetime="Sat May 28 2022 19:20:00 GMT+1200 (New Zealand Standard Time)">May 28, 2022</time> · Around
            3 minutes
          </div>
        </header>
        <div id="post-body">
          <p>
            I've been a subscriber to <a href="https://fastmail.com">Fastmail</a> now for probably a good five years at
            least, if not more at this point.
          </p>
          <p>
            It's a really nice service, not just for email but also email and contact hosting and for most clients, it
            all basically works out of the box as you might hope.
          </p>
          <p>
            A number of services that integration with calendars tend to only offer
            <a href="https://en.wikipedia.org/wiki/Google_Calendar">Google Calendar</a> integration but thankfully
            CalDAV integration pops up from time to time.
          </p>
          <p>One thing that I think can be a little bit confusing for people is the Fastmail documentation.</p>
          <p>
            If we visit the
            <a href="https://www.fastmail.help/hc/en-us/articles/1500000278342-Server-names-and-ports#calendar"
              >Server names and ports</a
            >
            page, it mentions <code>https://caldav.fastmail.com/</code> as the default server for clients with
            auto-discovery with
            <a href="https://www.fastmail.help/hc/en-us/articles/360058752834">a support page</a> for other clients.
          </p>
          <p>
            That's perfectly correct but a number of CalDAV libraries I've seen around the place tend to complain about
            that base URL.
          </p>
          <p>
            Most recently, I ran into this with
            <a href="https://github.com/davish/obsidian-full-calendar/issues/87">obsidian-full-calendar</a> where
            Fastmail integration was considered not working but really, the wrong server name was being used.
          </p>
          <p>
            If <code>https://caldav.fastmail.com/</code> doesn't work, odds are you'll get what you're after by using
            the following server name:
          </p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="text"
              data-theme="dark"
            ><code data-language="text" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #e0def4">https://caldav.fastmail.com/dav/principals/user/user@example.com/</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="text"
              data-theme="light"
            ><code data-language="text" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #575279">https://caldav.fastmail.com/dav/principals/user/user@example.com/</span></span></code></pre>
          </div>
          <p>
            <em
              ><strong><a href="mailto:user@example.com">user@example.com</a></strong> is the email address that you use
              for Fastmail.</em
            >
          </p>
          <p>
            You can confirm that by navigating to your Fastmail inbox and seeing what address in the top left corner if
            you really need to.
          </p>
          <p>
            Alternatively, you could also navigate to <code>Settings</code> → <code>Calendars</code> →
            <code>Export</code> (on one of the calendars) and copy most of the section from <code>CalDAV URL</code>.
          </p>
          <p>
            <center>
              <figure>
                <img
                  src="https://cdn.utf9k.net/blog/fastmail-caldav/calendar-settings.png"
                  alt="A screenshot of the author&#x27;s Fastmail account, showing the Settings page. The Calendars tab is highlighted in the left sidebar. Three calendars are visible in the background with a modal open in the foreground. The modal has two sections: One deals with exporting a calendar. The other has a text box with the CalDAV URL for the selected calendar. An arrow is pointing to the text box. The contents of the textbox is highlighted up to the end of the segment containing the author&#x27;s email. The ID at the end is not selected although this is not visible as it is blurred out."
                />
              </figure>
            </center>
          </p>
          <p>
            Putting the whole URL will only load one calendar but odds are, whatever CalDAV client you're struggling
            with will load all of your calendars by removing the calendar ID at the end.
          </p>
          <p>
            Why does this work exactly? Well, I'm no expert here but I gave a brief overview of my understanding by way
            of
            <a href="https://github.com/davish/obsidian-full-calendar/pull/106#issuecomment-1120536933"
              >this Github comment</a
            >.
          </p>
          <p>For completeness, I've quoted it verbatim:</p>
          <blockquote>
            <p>
              For anyone interested, Fastmail uses <a href="https://www.cyrusimap.org/">Cyrus IMAP</a> which is an
              all-in-one IMAP, CalDAV and CardDAV server. As I understand it, it
              <a href="https://www.cyrusimap.org/imap/concepts/features/dav-collection-mgmt.html"
                >represents calendars as mailboxes under the hood</a
              >
              hence why you use your Fastmail address as the identifier. That is, you have a single "calendar" in the UI
              but you can have multiple calendars on it eg; one for Events, one for Work and so on.
            </p>
            <p>In fact, we can prove this by requesting a bogus calendar:</p>
          </blockquote>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="shell"
              data-theme="dark"
            ><code data-language="shell" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #EA9A97">$</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">curl</span><span style="color: #E0DEF4"> </span><span style="color: #3E8FB0">-u</span><span style="color: #E0DEF4"> </span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #F6C177">fastmail-emai</span><span style="color: #E0DEF4">l</span><span style="color: #3E8FB0">></span><span style="color: #F6C177">:</span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #F6C177">fastmail-app-passwor</span><span style="color: #E0DEF4">d</span><span style="color: #3E8FB0">></span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">https://caldav.fastmail.com/dav/calendars/user/</span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #F6C177">fastmail-emai</span><span style="color: #E0DEF4">l</span><span style="color: #3E8FB0">></span><span style="color: #F6C177">/blah</span></span>
<span data-line=""><span style="color: #3E8FB0">&#x3C;!</span><span style="color: #EA9A97">DOCTYPE</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">HTML</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">PUBLIC</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">"-//W3C//DTD HTML 4.01 Transitional//EN"</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">"http://www.w3.org/TR/html4/loose.dtd"</span><span style="color: #3E8FB0">></span></span>
<span data-line=""><span style="color: #3E8FB0">&#x3C;</span><span style="color: #E0DEF4">html</span><span style="color: #3E8FB0">></span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #EA9A97">head></span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #EA9A97">title>404</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Not</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Found</span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #F6C177">/titl</span><span style="color: #E0DEF4">e</span><span style="color: #3E8FB0">></span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #EA9A97">/head></span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #EA9A97">body></span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #EA9A97">h1>Not</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Found</span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #F6C177">/h</span><span style="color: #3E8FB0">1></span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #EA9A97">p>Mailbox</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">does</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">not</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">exist</span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #F6C177">/</span><span style="color: #E0DEF4">p</span><span style="color: #3E8FB0">></span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #EA9A97">hr></span></span>
<span data-line=""><span style="color: #E0DEF4">    </span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #EA9A97">address>Cyrus-HTTP/3.7.0-alpha0-591-gfe6c3a2700-fm-20220427.001-gfe6c3a27</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Cyrus-SASL/2.1.27</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Lib/XML2.9.10</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Jansson/2.13.1</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">OpenSSL/1.1.1n</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Wslay/1.1.1</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Zlib/1.2.11</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Brotli/1.0.9</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Xapian/1.5.0</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">LibiCal/3.0</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">ICU4C/69.1</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">SQLite/3.34.1</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Server</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">at</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">caldav.fastmail.com</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Port</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">2075</span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #F6C177">/addres</span><span style="color: #E0DEF4">s</span><span style="color: #3E8FB0">></span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #3E8FB0">&#x3C;</span><span style="color: #EA9A97">/body></span></span>
<span data-line=""><span style="color: #3E8FB0">&#x3C;</span><span style="color: #E0DEF4">/html</span><span style="color: #3E8FB0">></span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="shell"
              data-theme="light"
            ><code data-language="shell" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #D7827E">$</span><span style="color: #575279"> </span><span style="color: #EA9D34">curl</span><span style="color: #575279"> </span><span style="color: #286983">-u</span><span style="color: #575279"> </span><span style="color: #286983">&#x3C;</span><span style="color: #EA9D34">fastmail-emai</span><span style="color: #575279">l</span><span style="color: #286983">></span><span style="color: #EA9D34">:</span><span style="color: #286983">&#x3C;</span><span style="color: #EA9D34">fastmail-app-passwor</span><span style="color: #575279">d</span><span style="color: #286983">></span><span style="color: #575279"> </span><span style="color: #EA9D34">https://caldav.fastmail.com/dav/calendars/user/</span><span style="color: #286983">&#x3C;</span><span style="color: #EA9D34">fastmail-emai</span><span style="color: #575279">l</span><span style="color: #286983">></span><span style="color: #EA9D34">/blah</span></span>
<span data-line=""><span style="color: #286983">&#x3C;!</span><span style="color: #D7827E">DOCTYPE</span><span style="color: #575279"> </span><span style="color: #EA9D34">HTML</span><span style="color: #575279"> </span><span style="color: #EA9D34">PUBLIC</span><span style="color: #575279"> </span><span style="color: #EA9D34">"-//W3C//DTD HTML 4.01 Transitional//EN"</span><span style="color: #575279"> </span><span style="color: #EA9D34">"http://www.w3.org/TR/html4/loose.dtd"</span><span style="color: #286983">></span></span>
<span data-line=""><span style="color: #286983">&#x3C;</span><span style="color: #575279">html</span><span style="color: #286983">></span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #286983">&#x3C;</span><span style="color: #D7827E">head></span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #286983">&#x3C;</span><span style="color: #D7827E">title>404</span><span style="color: #575279"> </span><span style="color: #EA9D34">Not</span><span style="color: #575279"> </span><span style="color: #EA9D34">Found</span><span style="color: #286983">&#x3C;</span><span style="color: #EA9D34">/titl</span><span style="color: #575279">e</span><span style="color: #286983">></span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #286983">&#x3C;</span><span style="color: #D7827E">/head></span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #286983">&#x3C;</span><span style="color: #D7827E">body></span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #286983">&#x3C;</span><span style="color: #D7827E">h1>Not</span><span style="color: #575279"> </span><span style="color: #EA9D34">Found</span><span style="color: #286983">&#x3C;</span><span style="color: #EA9D34">/h</span><span style="color: #286983">1></span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #286983">&#x3C;</span><span style="color: #D7827E">p>Mailbox</span><span style="color: #575279"> </span><span style="color: #EA9D34">does</span><span style="color: #575279"> </span><span style="color: #EA9D34">not</span><span style="color: #575279"> </span><span style="color: #EA9D34">exist</span><span style="color: #286983">&#x3C;</span><span style="color: #EA9D34">/</span><span style="color: #575279">p</span><span style="color: #286983">></span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #286983">&#x3C;</span><span style="color: #D7827E">hr></span></span>
<span data-line=""><span style="color: #575279">    </span><span style="color: #286983">&#x3C;</span><span style="color: #D7827E">address>Cyrus-HTTP/3.7.0-alpha0-591-gfe6c3a2700-fm-20220427.001-gfe6c3a27</span><span style="color: #575279"> </span><span style="color: #EA9D34">Cyrus-SASL/2.1.27</span><span style="color: #575279"> </span><span style="color: #EA9D34">Lib/XML2.9.10</span><span style="color: #575279"> </span><span style="color: #EA9D34">Jansson/2.13.1</span><span style="color: #575279"> </span><span style="color: #EA9D34">OpenSSL/1.1.1n</span><span style="color: #575279"> </span><span style="color: #EA9D34">Wslay/1.1.1</span><span style="color: #575279"> </span><span style="color: #EA9D34">Zlib/1.2.11</span><span style="color: #575279"> </span><span style="color: #EA9D34">Brotli/1.0.9</span><span style="color: #575279"> </span><span style="color: #EA9D34">Xapian/1.5.0</span><span style="color: #575279"> </span><span style="color: #EA9D34">LibiCal/3.0</span><span style="color: #575279"> </span><span style="color: #EA9D34">ICU4C/69.1</span><span style="color: #575279"> </span><span style="color: #EA9D34">SQLite/3.34.1</span><span style="color: #575279"> </span><span style="color: #EA9D34">Server</span><span style="color: #575279"> </span><span style="color: #EA9D34">at</span><span style="color: #575279"> </span><span style="color: #EA9D34">caldav.fastmail.com</span><span style="color: #575279"> </span><span style="color: #EA9D34">Port</span><span style="color: #575279"> </span><span style="color: #D7827E">2075</span><span style="color: #286983">&#x3C;</span><span style="color: #EA9D34">/addres</span><span style="color: #575279">s</span><span style="color: #286983">></span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #286983">&#x3C;</span><span style="color: #D7827E">/body></span></span>
<span data-line=""><span style="color: #286983">&#x3C;</span><span style="color: #575279">/html</span><span style="color: #286983">></span></span></code></pre>
          </div>
          <p><em>Note how it is looking for a mailbox despite being a caldav server</em></p>
          <blockquote>
            <p>So yeah, your calendars are just email inboxes under the hood with Fastmail!</p>
            <p>
              More specifically, there is a mailbox per calendar (I think) and that mailbox is full of
              <a href="https://en.wikipedia.org/wiki/ICalendar">ics</a> files
            </p>
          </blockquote>
        </div>
      </article>

      <script src="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.js" type="text/javascript"></script>
      <script type="text/javascript">
        littlefoot.littlefoot(); // Pass any littlefoot settings here.
      </script>
    </div>
    <div id="fullscreen"></div>
    <script type="module">
      import "/js/image-viewer.js";
    </script>
  </body>
</html>

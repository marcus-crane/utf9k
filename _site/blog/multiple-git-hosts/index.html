<!doctype html>
<html lang="en">
  <head>
    <title>utf9k</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="theme-color" content="#eaebe3" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1f2738" media="(prefers-color-scheme: dark)" />
    <meta name="author" content="Marcus Crane" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" href="/favicon.png" sizes="16x16" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    <link rel="me" href="mailto:hello@utf9k.net" />
    <link rel="me" href="https://mastodon.nz/@utf9k" />
    <link rel="me" href="https://twitter.com/sentreh" />
    <link rel="me" href="https://github.com/marcus-crane" />
    <link rel="webmention" href="https://webmention.io/utf9k.net/webmention" />
    <link rel="pingback" href="https://webmention.io/utf9k.net/xmlrpc" />
    <link rel="stylesheet" href="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.css" />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <header class="navigation">
      <a href="/" id="logo">
        <img src="/favicon.png" alt="utf9k" width="16px" height="16px" />
        <span>utf9k</span>
      </a>
      <nav>
        <li><a href="/blog/">Blog</a></li>
        <span>//</span>
        <li><a href="/projects/">Projects</a></li>
        <span>//</span>
        <li><a href="/about/">About</a></li>
        <span>//</span>
        <li><a href="/questions/">Questions</a></li>
        <span>//</span>
        <li><a href="/rss.xml">RSS</a></li>
      </nav>
    </header>
    <div id="content">
      <article>
        <header>
          <h1>Dealing with multiple git hosts</h1>

          <div id="post-meta">
            <time datetime="Mon Jan 06 2020 00:00:00 GMT+1300 (New Zealand Daylight Time)">January 6, 2020</time> ·
            Around 3 minutes
          </div>
        </header>
        <div id="post-body">
          <div class="notice">
            <hr class="hidden" />
            <h3>
              <span>⏰</span>
              Some things have changed since I first wrote this
            </h3>
            <p>At the time of writing, I was using Gitlab so you'll see references to my dotfiles living there.</p>
            <p>I've now moved back to Github but kept the references to Gitlab in this post intact.</p>
            <hr class="hidden" />
          </div>
          <p>
            When using my work laptop, I like to keep a copy of my dotfiles so that my tools at work are in sync with my
            tools at home. They <a href="https://github.com/marcus-crane/dotfiles">live in a Github repository</a> under
            my personal account, and I use plain old git to sync changes.
          </p>
          <p>
            In order to push and pull changes from Github, I use an SSH key rather than a password. It's easy enough to
            generate one of course but I also have one for the internal repository at my work. Juggling the two can
            sometimes be annoying when setting up a fresh laptop without some proper configuration.
          </p>
          <p>
            Usually I forget what that looks like so here's a quick walkthrough on how you too can juggle multiple git
            hosts.
          </p>
          <p>Let's have a look at a barebones ssh configuration file:</p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="shell"
              data-theme="dark"
            ><code data-language="shell" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #3E8FB0">></span><span style="color: #E0DEF4"> cat </span><span style="color: #3E8FB0">~</span><span style="color: #E0DEF4">/.ssh/config</span></span>
<span data-line=""><span style="color: #EA9A97">Host</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">github.example.com</span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #EA9A97">IdentityFile</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">~/.ssh/work</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #EA9A97">Host</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">gitlab.com</span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #EA9A97">IdentityFile</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">~/.ssh/personal</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #EA9A97">Host</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">github.com</span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #EA9A97">IdentityFile</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">~/.ssh/personal</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="shell"
              data-theme="light"
            ><code data-language="shell" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #286983">></span><span style="color: #575279"> cat </span><span style="color: #286983">~</span><span style="color: #575279">/.ssh/config</span></span>
<span data-line=""><span style="color: #D7827E">Host</span><span style="color: #575279"> </span><span style="color: #EA9D34">github.example.com</span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #D7827E">IdentityFile</span><span style="color: #575279"> </span><span style="color: #EA9D34">~/.ssh/work</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #D7827E">Host</span><span style="color: #575279"> </span><span style="color: #EA9D34">gitlab.com</span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #D7827E">IdentityFile</span><span style="color: #575279"> </span><span style="color: #EA9D34">~/.ssh/personal</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #D7827E">Host</span><span style="color: #575279"> </span><span style="color: #EA9D34">github.com</span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #D7827E">IdentityFile</span><span style="color: #575279"> </span><span style="color: #EA9D34">~/.ssh/personal</span></span></code></pre>
          </div>
          <p>We've got three different hosts and two different SSH keys.</p>
          <p>
            Whenever you use <code>ssh</code>, it'll check to see if you have any host blocks defined. If they match the
            host provided, it'll use the corresponding configuration.
          </p>
          <p>Let's see how it looks in action:</p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="shell"
              data-theme="dark"
            ><code data-language="shell" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #3E8FB0">></span><span style="color: #E0DEF4"> ssh -T git@github.example.com</span></span>
<span data-line=""><span style="color: #EA9A97">Hi</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">marcus!</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">You've successfully authenticated, but GitHub does not provide shell access.</span></span>
<span data-line=""><span style="color: #F6C177">> ssh -T git@gitlab.com</span></span>
<span data-line=""><span style="color: #F6C177">Welcome to GitLab, @marcus-crane!</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="shell"
              data-theme="light"
            ><code data-language="shell" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #286983">></span><span style="color: #575279"> ssh -T git@github.example.com</span></span>
<span data-line=""><span style="color: #D7827E">Hi</span><span style="color: #575279"> </span><span style="color: #EA9D34">marcus!</span><span style="color: #575279"> </span><span style="color: #EA9D34">You've successfully authenticated, but GitHub does not provide shell access.</span></span>
<span data-line=""><span style="color: #EA9D34">> ssh -T git@gitlab.com</span></span>
<span data-line=""><span style="color: #EA9D34">Welcome to GitLab, @marcus-crane!</span></span></code></pre>
          </div>
          <p>
            The connection to <code>github.example.com</code> uses the key stored at <code>~/.ssh/work</code>, while the
            connection to <code>gitlab.com</code> has used the key stored at <code>~/.ssh/personal</code>. Perfect!
          </p>
          <p>You can also add additional configuration that is specific to just one host.</p>
          <p>Let's look at an example with a few more options:</p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="shell"
              data-theme="dark"
            ><code data-language="shell" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #3E8FB0">></span><span style="color: #E0DEF4"> cat </span><span style="color: #3E8FB0">~</span><span style="color: #E0DEF4">/.ssh/config</span></span>
<span data-line=""><span style="color: #EA9A97">Host</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">github.example.com</span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #EA9A97">IdentityFile</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">~/.ssh/work</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #EA9A97">Host</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">gitlab.com</span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #EA9A97">IdentityFile</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">~/.ssh/personal</span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #EA9A97">LogLevel</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">VERBOSE</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #EA9A97">Host</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">github.com</span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #EA9A97">HostName</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">notarealuser</span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #EA9A97">IdentityFile</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">~/.ssh/personal</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="shell"
              data-theme="light"
            ><code data-language="shell" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #286983">></span><span style="color: #575279"> cat </span><span style="color: #286983">~</span><span style="color: #575279">/.ssh/config</span></span>
<span data-line=""><span style="color: #D7827E">Host</span><span style="color: #575279"> </span><span style="color: #EA9D34">github.example.com</span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #D7827E">IdentityFile</span><span style="color: #575279"> </span><span style="color: #EA9D34">~/.ssh/work</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #D7827E">Host</span><span style="color: #575279"> </span><span style="color: #EA9D34">gitlab.com</span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #D7827E">IdentityFile</span><span style="color: #575279"> </span><span style="color: #EA9D34">~/.ssh/personal</span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #D7827E">LogLevel</span><span style="color: #575279"> </span><span style="color: #EA9D34">VERBOSE</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #D7827E">Host</span><span style="color: #575279"> </span><span style="color: #EA9D34">github.com</span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #D7827E">HostName</span><span style="color: #575279"> </span><span style="color: #EA9D34">notarealuser</span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #D7827E">IdentityFile</span><span style="color: #575279"> </span><span style="color: #EA9D34">~/.ssh/personal</span></span></code></pre>
          </div>
          <p>
            It's mostly the same with two new commands <code>LogLevel</code> and <code>HostName</code>. Let's see it in
            action once again before we dive a bit deeper:
          </p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="shell"
              data-theme="dark"
            ><code data-language="shell" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #3E8FB0">></span><span style="color: #E0DEF4"> ssh -T git@github.com</span></span>
<span data-line=""><span style="color: #EA9A97">ssh:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Could</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">not</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">resolve</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">hostname</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">notarealuser:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">Name</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">or</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">service</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">not</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">known</span></span>
<span data-line=""><span style="color: #3E8FB0">></span><span style="color: #E0DEF4"> ssh -T git@gitlab.com</span></span>
<span data-line=""><span style="color: #EA9A97">Authenticated</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">to</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">gitlab.com</span><span style="color: #E0DEF4"> ([35.231.145.151]:22).</span></span>
<span data-line=""><span style="color: #EA9A97">Welcome</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">to</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">GitLab,</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">@marcus-crane!</span></span>
<span data-line=""><span style="color: #EA9A97">Transferred:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">sent</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">2036</span><span style="color: #F6C177">,</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">received</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">3072</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">bytes,</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">in</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">0.5</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">seconds</span></span>
<span data-line=""><span style="color: #EA9A97">Bytes</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">per</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">second:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">sent</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">4366.6</span><span style="color: #F6C177">,</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">received</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">6588.4</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="shell"
              data-theme="light"
            ><code data-language="shell" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #286983">></span><span style="color: #575279"> ssh -T git@github.com</span></span>
<span data-line=""><span style="color: #D7827E">ssh:</span><span style="color: #575279"> </span><span style="color: #EA9D34">Could</span><span style="color: #575279"> </span><span style="color: #EA9D34">not</span><span style="color: #575279"> </span><span style="color: #EA9D34">resolve</span><span style="color: #575279"> </span><span style="color: #EA9D34">hostname</span><span style="color: #575279"> </span><span style="color: #EA9D34">notarealuser:</span><span style="color: #575279"> </span><span style="color: #EA9D34">Name</span><span style="color: #575279"> </span><span style="color: #EA9D34">or</span><span style="color: #575279"> </span><span style="color: #EA9D34">service</span><span style="color: #575279"> </span><span style="color: #EA9D34">not</span><span style="color: #575279"> </span><span style="color: #EA9D34">known</span></span>
<span data-line=""><span style="color: #286983">></span><span style="color: #575279"> ssh -T git@gitlab.com</span></span>
<span data-line=""><span style="color: #D7827E">Authenticated</span><span style="color: #575279"> </span><span style="color: #EA9D34">to</span><span style="color: #575279"> </span><span style="color: #EA9D34">gitlab.com</span><span style="color: #575279"> ([35.231.145.151]:22).</span></span>
<span data-line=""><span style="color: #D7827E">Welcome</span><span style="color: #575279"> </span><span style="color: #EA9D34">to</span><span style="color: #575279"> </span><span style="color: #EA9D34">GitLab,</span><span style="color: #575279"> </span><span style="color: #EA9D34">@marcus-crane!</span></span>
<span data-line=""><span style="color: #D7827E">Transferred:</span><span style="color: #575279"> </span><span style="color: #EA9D34">sent</span><span style="color: #575279"> </span><span style="color: #D7827E">2036</span><span style="color: #EA9D34">,</span><span style="color: #575279"> </span><span style="color: #EA9D34">received</span><span style="color: #575279"> </span><span style="color: #D7827E">3072</span><span style="color: #575279"> </span><span style="color: #EA9D34">bytes,</span><span style="color: #575279"> </span><span style="color: #EA9D34">in</span><span style="color: #575279"> </span><span style="color: #D7827E">0.5</span><span style="color: #575279"> </span><span style="color: #EA9D34">seconds</span></span>
<span data-line=""><span style="color: #D7827E">Bytes</span><span style="color: #575279"> </span><span style="color: #EA9D34">per</span><span style="color: #575279"> </span><span style="color: #EA9D34">second:</span><span style="color: #575279"> </span><span style="color: #EA9D34">sent</span><span style="color: #575279"> </span><span style="color: #D7827E">4366.6</span><span style="color: #EA9D34">,</span><span style="color: #575279"> </span><span style="color: #EA9D34">received</span><span style="color: #575279"> </span><span style="color: #D7827E">6588.4</span></span></code></pre>
          </div>
          <p>
            We can see that we sent a request to <code>github.com</code> and it interpreted the corresponding host
            block, attempting to log in as someone called <code>notarealuser</code>.
          </p>
          <p>
            For most git servers, the user will default to <code>git</code> and is generally part of your remote anyway.
            You can see it whenever you run <code>git remote add origin git@github.com/user/blah</code> or
            <code>git remote -v</code>.
          </p>
          <p>
            It can be quite handy for regular servers however. Instead of connecting with
            <code>ssh user@blah.net</code>, you can add the username to a host block and shorten that command down to
            just <code>ssh blah.net</code>
          </p>
          <p>
            The <code>LogLevel</code> command is fairly straight forward. You can set it to a higher level of logging,
            and see more details about what SSH is doing under the hood, but for a specific host.
          </p>
          <p>
            If you're getting error messages from your internal git host, you could toggle on
            <code>LogLevel DEBUG</code> and see if your requests are making their way to the host or not as an example.
          </p>
          <p>
            I'm sure there's all sorts of interesting stuff you could do but this post isn't meant to be comprehensive
            by any means. It's more of a reminder to myself on how to create an ssh config file.
          </p>
          <p>
            You can see all of the various commands offline by running <code>man ssh_config</code>. You can also read
            them online via the <a href="https://man.openbsd.org/ssh_config">OpenBSD manual page server</a>.
          </p>
          <p>Happy SSHing!</p>
        </div>
      </article>

      <script src="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.js" type="text/javascript"></script>
      <script type="text/javascript">
        littlefoot.littlefoot(); // Pass any littlefoot settings here.
      </script>
    </div>
    <div id="fullscreen"></div>
    <script type="module">
      import "/js/image-viewer.js";
    </script>
  </body>
</html>

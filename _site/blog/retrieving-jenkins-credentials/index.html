<!doctype html>
<html lang="en">
  <head>
    <title>utf9k</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="theme-color" content="#eaebe3" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1f2738" media="(prefers-color-scheme: dark)" />
    <meta name="author" content="Marcus Crane" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" href="/favicon.png" sizes="16x16" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    <link rel="me" href="mailto:hello@utf9k.net" />
    <link rel="me" href="https://mastodon.nz/@utf9k" />
    <link rel="me" href="https://twitter.com/sentreh" />
    <link rel="me" href="https://github.com/marcus-crane" />
    <link rel="webmention" href="https://webmention.io/utf9k.net/webmention" />
    <link rel="pingback" href="https://webmention.io/utf9k.net/xmlrpc" />
    <link rel="stylesheet" href="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.css" />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <header class="navigation">
      <a href="/" id="logo">
        <img src="/favicon.png" alt="utf9k" width="16px" height="16px" />
        <span>utf9k</span>
      </a>
      <nav>
        <li><a href="/blog/">Blog</a></li>
        <span>//</span>
        <li><a href="/projects/">Projects</a></li>
        <span>//</span>
        <li><a href="/about/">About</a></li>
        <span>//</span>
        <li><a href="/questions/">Questions</a></li>
        <span>//</span>
        <li><a href="/rss.xml">RSS</a></li>
      </nav>
    </header>
    <div id="content">
      <article>
        <header>
          <h1>Retrieving credentials from Jenkins</h1>

          <div id="post-meta">
            <time datetime="Sun Jul 28 2019 23:00:00 GMT+1200 (New Zealand Standard Time)">July 28, 2019</time> Â· Around
            2 minutes
          </div>
        </header>
        <div id="post-body">
          <p>
            Have you ever stored a password in Jenkins, only to forget later on what the value is? You might try logging
            it from inside an existing job, but you'll find that Jenkins goes out of its way to mask that value from you
            (and any potential attackers!)
          </p>
          <p>
            There's a sneaky way to get those credentials out of a Jenkins agent that requires only a little bit of
            wrangling. It may be possible to lock this down, I haven't looked, so it's good to be aware of it, in order
            to consider the security implications too.
          </p>
          <p>Find the password you want to get your hands on</p>
          <p>
            <center>
              <figure>
                <img
                  src="https://cdn.utf9k.net/blog/retrieving-jenkins-credentials/01-credential-view.png"
                  alt="A screenshot of the Jenkins UI. It is showing the credentials section. It depicts a password entry called &#x27;My super secret password&#x27; although no actual credentials are visible."
                />
              </figure>
            </center>
          </p>
          <p>Click <code>Update</code> which will show you an obscured version of the secret</p>
          <p>
            <center>
              <figure>
                <img
                  src="https://cdn.utf9k.net/blog/retrieving-jenkins-credentials/02-credential-update.png"
                  alt="A screenshot of the Jenkins UI progressed from the previous image. Metadata about the selected credential are visible such as scope, ID and description. There is a secret field but it just contains dots like any normal password field does, rather than the actual password text."
                />
              </figure>
            </center>
          </p>
          <p>
            Right click on the <code>Secret</code> field and hit <code>Inspect Element</code> to bring up the developer
            tools for your browser
          </p>
          <p>
            <center>
              <figure>
                <img
                  src="https://cdn.utf9k.net/blog/retrieving-jenkins-credentials/03-inspect-element.png"
                  alt="A screenshot of the Jenkins UI. The user has right clicked on the secret field of the credential metadata. Their browser context menu is visible, invoked by right clicking. The &#x27;Inspect Element&#x27; item is highlighted but not yet clicked."
                />
              </figure>
            </center>
          </p>
          <p>
            Either right click on the <code>value</code> part of the input field, or double click on the value area and
            copy the wonky looking hash. It'll be surrounded with braces eg; <code>{ABC123=}</code>
          </p>
          <p>
            <center>
              <figure>
                <img
                  src="https://cdn.utf9k.net/blog/retrieving-jenkins-credentials/04-credential-hash.png"
                  alt="A screenshot of the Firefox browser tools. The user has found the DOM node for the redacted input in the element selector pane. They have right clicked it, bringing up the browser context menu and have highlighted &#x27;Copy attribute value&#x27; under the &#x27;Attributes&#x27; submenu."
                />
              </figure>
            </center>
          </p>
          <p>
            With that value in your clipboard, go to <code>/script</code> eg;
            <code>https://jenkins.example.com/script</code> or from the homepage, visit
            <code>Manage Jenkins -> Script Console</code>
          </p>
          <p>
            <center>
              <figure>
                <img
                  src="https://cdn.utf9k.net/blog/retrieving-jenkins-credentials/05-script-console.png"
                  alt="A screenshot of the Jenkins UI. It shows the &#x27;Script Console&#x27; page which lives under /script by default."
                />
              </figure>
            </center>
          </p>
          <p>
            Enter the following into the script console:
            <code>println(hudson.util.Secret.decrypt('&#x3C;paste hash here>'))</code>. Make sure to include the braces
            and the single quotes. You should see your credential output as seen below
          </p>
          <p>
            <center>
              <figure>
                <img
                  src="https://cdn.utf9k.net/blog/retrieving-jenkins-credentials/06-final-result.png"
                  alt="A screenshot of the Jenkins Script Console UI. The user has pasted the copied input from the Firefox browser tools that was open in an earlier screenshot. This input has been wrapped in some Jenkins functions. Below the Script Console is an output area with the actual password of the credential that was previously redacted."
                />
              </figure>
            </center>
          </p>
          <p>
            It's a pretty handy trick, but quite obviously a borderline exploit at the same time. It's up to you to use
            it responsibly!
          </p>
        </div>
      </article>

      <script src="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.js" type="text/javascript"></script>
      <script type="text/javascript">
        littlefoot.littlefoot(); // Pass any littlefoot settings here.
      </script>
    </div>
    <div id="fullscreen"></div>
    <script type="module">
      import "/js/image-viewer.js";
    </script>
  </body>
</html>

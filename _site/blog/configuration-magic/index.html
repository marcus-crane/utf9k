<!doctype html>
<html lang="en">
  <head>
    <title>utf9k</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="theme-color" content="#eaebe3" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1f2738" media="(prefers-color-scheme: dark)" />
    <meta name="author" content="Marcus Crane" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" href="/favicon.png" sizes="16x16" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    <link rel="me" href="mailto:hello@utf9k.net" />
    <link rel="me" href="https://mastodon.nz/@utf9k" />
    <link rel="me" href="https://twitter.com/sentreh" />
    <link rel="me" href="https://github.com/marcus-crane" />
    <link rel="webmention" href="https://webmention.io/utf9k.net/webmention" />
    <link rel="pingback" href="https://webmention.io/utf9k.net/xmlrpc" />
    <link rel="stylesheet" href="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.css" />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <header class="navigation">
      <a href="/" id="logo">
        <img src="/favicon.png" alt="utf9k" width="16px" height="16px" />
        <span>utf9k</span>
      </a>
      <nav>
        <li><a href="/blog/">Blog</a></li>
        <span>//</span>
        <li><a href="/projects/">Projects</a></li>
        <span>//</span>
        <li><a href="/about/">About</a></li>
        <span>//</span>
        <li><a href="/questions/">Questions</a></li>
        <span>//</span>
        <li><a href="/rss.xml">RSS</a></li>
      </nav>
    </header>
    <div id="content">
      <article>
        <header>
          <h1>Configuration magic</h1>

          <div id="post-meta">
            <time datetime="Fri Nov 20 2020 00:00:00 GMT+1300 (New Zealand Daylight Time)">November 20, 2020</time> ·
            Around 4 minutes
          </div>
        </header>
        <div id="post-body">
          <p>
            I don't consider myself qualified enough to write much on the art of programming but I think this is
            probably the closest I've ever found myself.
          </p>
          <h2 id="the-situation">
            <a aria-hidden="true" class="jumplink" tabindex="-1" href="#the-situation">¶ </a>The situation
          </h2>
          <p>
            I'm currently looking at a repo for controlling infrastructure which is comprised of a lot of
            <code>yaml</code> files, and the documentation was a bit sparse, at least as far as I can see.
          </p>
          <p>
            While the specifics of the domain don't really matter too much, the repository mainly defines a lot of
            compute resources.
          </p>
          <p>In order to make it easier to visualise, here's an example that roughly shows how it's laid out:</p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="bash"
              data-theme="dark"
            ><code data-language="bash" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #3E8FB0">></span><span style="color: #E0DEF4"> tree Resources</span></span>
<span data-line=""><span style="color: #EA9A97">Resources</span></span>
<span data-line=""><span style="color: #EA9A97">├──</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">test</span></span>
<span data-line=""><span style="color: #EA9A97">│  </span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">├──</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">teamA.yaml</span></span>
<span data-line=""><span style="color: #EA9A97">│  </span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">├──</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">teamB.yaml</span></span>
<span data-line=""><span style="color: #EA9A97">├──</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">staging</span></span>
<span data-line=""><span style="color: #EA9A97">│  </span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">└──</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">teamB.yaml</span></span>
<span data-line=""><span style="color: #EA9A97">├──</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">production</span></span>
<span data-line=""><span style="color: #EA9A97">│  </span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">├──</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">teamA.yaml</span></span>
<span data-line=""><span style="color: #EA9A97">│  </span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">├──</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">teamB.yaml</span></span>
<span data-line=""><span style="color: #EA9A97">│  </span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">└──</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">teamC.yaml</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="bash"
              data-theme="light"
            ><code data-language="bash" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #286983">></span><span style="color: #575279"> tree Resources</span></span>
<span data-line=""><span style="color: #D7827E">Resources</span></span>
<span data-line=""><span style="color: #D7827E">├──</span><span style="color: #575279"> </span><span style="color: #EA9D34">test</span></span>
<span data-line=""><span style="color: #D7827E">│  </span><span style="color: #575279"> </span><span style="color: #EA9D34">├──</span><span style="color: #575279"> </span><span style="color: #EA9D34">teamA.yaml</span></span>
<span data-line=""><span style="color: #D7827E">│  </span><span style="color: #575279"> </span><span style="color: #EA9D34">├──</span><span style="color: #575279"> </span><span style="color: #EA9D34">teamB.yaml</span></span>
<span data-line=""><span style="color: #D7827E">├──</span><span style="color: #575279"> </span><span style="color: #EA9D34">staging</span></span>
<span data-line=""><span style="color: #D7827E">│  </span><span style="color: #575279"> </span><span style="color: #EA9D34">└──</span><span style="color: #575279"> </span><span style="color: #EA9D34">teamB.yaml</span></span>
<span data-line=""><span style="color: #D7827E">├──</span><span style="color: #575279"> </span><span style="color: #EA9D34">production</span></span>
<span data-line=""><span style="color: #D7827E">│  </span><span style="color: #575279"> </span><span style="color: #EA9D34">├──</span><span style="color: #575279"> </span><span style="color: #EA9D34">teamA.yaml</span></span>
<span data-line=""><span style="color: #D7827E">│  </span><span style="color: #575279"> </span><span style="color: #EA9D34">├──</span><span style="color: #575279"> </span><span style="color: #EA9D34">teamB.yaml</span></span>
<span data-line=""><span style="color: #D7827E">│  </span><span style="color: #575279"> </span><span style="color: #EA9D34">└──</span><span style="color: #575279"> </span><span style="color: #EA9D34">teamC.yaml</span></span></code></pre>
          </div>
          <p>
            Each team has a <code>yaml</code> file per environment and each file defines a variety of resources such as
            databases, caches and so on.
          </p>
          <p>
            Let's look inside a file to see an example. Once again, I'm using entirely made up values but the idea is
            roughly the same.
          </p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="yaml"
              data-theme="dark"
            ><code data-language="yaml" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #3E8FB0">></span><span style="color: #EB6F92"> less Resources/test/teamA.yaml</span></span>
<span data-line=""><span style="color: #9CCFD8">MySQL</span><span style="color: #908CAA">:</span></span>
<span data-line=""><span style="color: #E0DEF4">	</span><span style="color: #908CAA">-</span><span style="color: #E0DEF4"> </span><span style="color: #9CCFD8">Name</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">my-sturdy-database</span></span>
<span data-line=""><span style="color: #E0DEF4">	  </span><span style="color: #9CCFD8">Group</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">TestResources</span></span>
<span data-line=""><span style="color: #E0DEF4">	  </span><span style="color: #9CCFD8">Resource</span><span style="color: #908CAA">:</span></span>
<span data-line=""><span style="color: #E0DEF4">	  	</span><span style="color: #9CCFD8">Size</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">PrettyBig</span></span>
<span data-line=""><span style="color: #E0DEF4">		</span><span style="color: #9CCFD8">Purpose</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">EatingMemory</span></span>
<span data-line=""><span style="color: #E0DEF4">		</span><span style="color: #9CCFD8">Replicas</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #EA9A97">1</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #9CCFD8">Varnish</span><span style="color: #908CAA">:</span></span>
<span data-line=""><span style="color: #E0DEF4">	</span><span style="color: #908CAA">-</span><span style="color: #E0DEF4"> </span><span style="color: #9CCFD8">Name</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">cache-me-up-scotty</span></span>
<span data-line=""><span style="color: #E0DEF4">	  </span><span style="color: #9CCFD8">Group</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">TestResources</span></span>
<span data-line=""><span style="color: #E0DEF4">	  </span><span style="color: #9CCFD8">Resource</span><span style="color: #908CAA">:</span></span>
<span data-line=""><span style="color: #E0DEF4">	  	</span><span style="color: #9CCFD8">Size</span><span style="color: #908CAA">:</span><span style="color: #E0DEF4"> </span><span style="color: #F6C177">ModeratelyBeefy</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="yaml"
              data-theme="light"
            ><code data-language="yaml" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #286983">></span><span style="color: #B4637A"> less Resources/test/teamA.yaml</span></span>
<span data-line=""><span style="color: #56949F">MySQL</span><span style="color: #797593">:</span></span>
<span data-line=""><span style="color: #575279">	</span><span style="color: #797593">-</span><span style="color: #575279"> </span><span style="color: #56949F">Name</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">my-sturdy-database</span></span>
<span data-line=""><span style="color: #575279">	  </span><span style="color: #56949F">Group</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">TestResources</span></span>
<span data-line=""><span style="color: #575279">	  </span><span style="color: #56949F">Resource</span><span style="color: #797593">:</span></span>
<span data-line=""><span style="color: #575279">	  	</span><span style="color: #56949F">Size</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">PrettyBig</span></span>
<span data-line=""><span style="color: #575279">		</span><span style="color: #56949F">Purpose</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">EatingMemory</span></span>
<span data-line=""><span style="color: #575279">		</span><span style="color: #56949F">Replicas</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #D7827E">1</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #56949F">Varnish</span><span style="color: #797593">:</span></span>
<span data-line=""><span style="color: #575279">	</span><span style="color: #797593">-</span><span style="color: #575279"> </span><span style="color: #56949F">Name</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">cache-me-up-scotty</span></span>
<span data-line=""><span style="color: #575279">	  </span><span style="color: #56949F">Group</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">TestResources</span></span>
<span data-line=""><span style="color: #575279">	  </span><span style="color: #56949F">Resource</span><span style="color: #797593">:</span></span>
<span data-line=""><span style="color: #575279">	  	</span><span style="color: #56949F">Size</span><span style="color: #797593">:</span><span style="color: #575279"> </span><span style="color: #EA9D34">ModeratelyBeefy</span></span></code></pre>
          </div>
          <p>
            I should note that we use neither <code>MySQL</code> or <code>Varnish</code> (to my knowledge) as they're
            just made up examples.
          </p>
          <p>
            Amongst that lot were also cloud resources and other things defined but the point is that there seemed to
            some sort of structure?
          </p>
          <p>As far as how I actually define anything, I have no idea.</p>
          <p>
            Surely, I can't just arbitrarily define a "Hadoop" block and get a
            <a href="https://www.chrisstucchio.com/blog/2013/hadoop_hatred.html">Hadoop cluster</a> out of thin air,
            that would be ridiculous!
          </p>
          <p>
            Wouldn't it? With no information to prove (or disprove) the idea that maybe it just magically works, I was
            reminded of an aspect of storytelling.
          </p>
          <h2 id="fictional-worldbuilding">
            <a aria-hidden="true" class="jumplink" tabindex="-1" href="#fictional-worldbuilding">¶ </a>Fictional
            worldbuilding
          </h2>
          <p>
            I'm not a writer by any stretch of the imagination but quite some time ago, I must've have been binging some
            videos on storytelling.
          </p>
          <p>
            I vaguely remember this idea that when creating a fiction world, you should
            <a href="https://kidlit.com/breaking-the-rules-in-world-building/">introduce the rules of the world</a> as
            early as possible.
          </p>
          <p>
            I believe it's best done within the first 15 minutes for a film but I had a hard time finding anything to
            back up that claim, although it seems sensible enough.
          </p>
          <p>
            The idea is that without rules to define your fictional world, anything and everything is possible. How can
            you have any sense of dramatic tension when your character could just arbitrarily become a superhuman when
            the story requires.
          </p>
          <p>
            Anyway, seeing that infrastructure repo reminded me of that, as the "rules" of what is possible aren't
            clear.
          </p>
          <p>
            Just to be clear as well, I'd say this is only really a side effect of when someone creates their own
            language of sorts.
          </p>
          <h2 id="is-text-a-good-interface">
            <a aria-hidden="true" class="jumplink" tabindex="-1" href="#is-text-a-good-interface">¶ </a>Is text a good
            interface?
          </h2>
          <p>
            To a developer or maintainer who is familiar with the repo in question, the idea that none of the above is
            completely obvious would probably make them laugh quite a bit.
          </p>
          <p>
            There is no such thing as magic when it comes to writing code, in so much as there are only more layers of
            code below the iceberg tip you're currently staring at.
          </p>
          <p>
            It only makes sense that there is machinery tucked away somewhere, likely a handful of scripts, which are
            parsing these files.
          </p>
          <p>
            After a bit of poking around, and some question asking, it turns out each of the keys defined are matched
            against a supplied template, and those parameters are baked into the template. The resulting output is then
            submitted to our cloud provider and creates/updates the defined resource.
          </p>
          <p>
            At this point, one could argue that the entire idea of creating an abstraction through yaml files has mostly
            broken down the second a user needs to poke behind the curtain.
          </p>
          <p>
            In a cruel twist of irony, some of those templates were actually deleted and so the keys supplied such as
            <code>MySQL</code> in our mock example, were doing nothing at all. You'd have no idea however because text
            can't really provide you feedback as a user like, say, a language with a linter might tell you about an
            unused variable.
          </p>
          <p>
            To be entirely clear, I have these same issues with most any <code>yaml</code> based format such as a Helm
            but I guess Helm has the begrudgingly awarded +1 of IDE support. Without it, I'd be tearing my hair out just
            as much.
          </p>
          <h2 id="whats-the-lesson-here">
            <a aria-hidden="true" class="jumplink" tabindex="-1" href="#whats-the-lesson-here">¶ </a>What's the lesson
            here
          </h2>
          <p>
            Well, I don't really have the vocabulary to do any meaningful criticisms or suggestions here. Once I get
            used to the repo in question, I'm sure I'll never think about it again and the cycle will repeat once more
            for whoever comes along next.
          </p>
          <p>
            Looking back, I must have missed something because there is a bit of documentation but still, it's fairly on
            explanation.
          </p>
          <p>
            Most of the setup follows convention over configuration but it sort of assumes you just know the convention
            too.
          </p>
          <p>
            I suppose to an extent, it's just to do with my lack of familiarity with our provider having only been a few
            months in.
          </p>
          <p>
            What I mainly wanted to capture was the feeling that arose from a lack of seeing a clear rule set. Not
            unlike a fictional rule set, without one, you're sort of left to infer the boundaries of the situation
            you're currently in.
          </p>
          <p>
            I think at its core though, I don't like using text or configuration files for programmatic things, as there
            isn't a whole heap of feedback until you apply said file?
          </p>
          <p>
            If I had to pick something that seems like a nice alternative, perhaps
            <a href="https://www.pulumi.com/product/#sdk">Pulumi</a>? I can't say I've really used it but on paper, it
            sounds kind of appealing.
          </p>
          <p>
            Well, in so much as infrastructure is appealing which some days I'd rather just have a nap to be honest.
          </p>
        </div>
      </article>

      <script src="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.js" type="text/javascript"></script>
      <script type="text/javascript">
        littlefoot.littlefoot(); // Pass any littlefoot settings here.
      </script>
    </div>
    <div id="fullscreen"></div>
    <script type="module">
      import "/js/image-viewer.js";
    </script>
  </body>
</html>

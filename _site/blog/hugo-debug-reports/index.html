<!doctype html>
<html lang="en">
  <head>
    <title>utf9k</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="theme-color" content="#eaebe3" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1f2738" media="(prefers-color-scheme: dark)" />
    <meta name="author" content="Marcus Crane" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" href="/favicon.png" sizes="16x16" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    <link rel="me" href="mailto:hello@utf9k.net" />
    <link rel="me" href="https://mastodon.nz/@utf9k" />
    <link rel="me" href="https://twitter.com/sentreh" />
    <link rel="me" href="https://github.com/marcus-crane" />
    <link rel="webmention" href="https://webmention.io/utf9k.net/webmention" />
    <link rel="pingback" href="https://webmention.io/utf9k.net/xmlrpc" />
    <link rel="stylesheet" href="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.css" />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <header class="navigation">
      <a href="/" id="logo">
        <img src="/favicon.png" alt="utf9k" width="16px" height="16px" />
        <span>utf9k</span>
      </a>
      <nav>
        <li><a href="/blog/">Blog</a></li>
        <span>//</span>
        <li><a href="/projects/">Projects</a></li>
        <span>//</span>
        <li><a href="/about/">About</a></li>
        <span>//</span>
        <li><a href="/questions/">Questions</a></li>
        <span>//</span>
        <li><a href="/rss.xml">RSS</a></li>
      </nav>
    </header>
    <div id="content">
      <article>
        <header>
          <h1>Creating debug reports with Hugo inline shortcodes</h1>

          <div id="post-meta">
            <time datetime="Mon Jul 12 2021 17:50:00 GMT+1200 (New Zealand Standard Time)">July 12, 2021</time> · Around
            3 minutes
          </div>
        </header>
        <div id="post-body">
          <p>
            Recently I discovered that <a href="https://gohugo.io">Hugo</a> added support for
            <a href="https://gohugo.io/templates/shortcode-templates/">inline shortcodes</a> like 30 versions ago.
          </p>
          <p>
            According to <a href="https://github.com/bep">bep</a>, the reason I had never heard about them was simple:
          </p>
          <blockquote class="twitter-tweet">
            <p lang="en" dir="ltr">
              You didn&#39;t ask ... (we added that to get the
              <a href="https://twitter.com/getbootstrap?ref_src=twsrc%5Etfw">@getbootstrap</a> site on Hugo, they had
              lots of inline scripting) ...
            </p>
            &mdash; Bjørn Erik Pedersen (@bepsays)
            <a href="https://twitter.com/bepsays/status/1408348824083615745?ref_src=twsrc%5Etfw">June 25, 2021</a>
          </blockquote>
          <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
          <h2 id="a-shortcode-refresher">
            <a aria-hidden="true" class="jumplink" tabindex="-1" href="#a-shortcode-refresher">¶ </a>A shortcode
            refresher
          </h2>
          <p>
            To give an idea of what this means, here's a reminder on how you were required to use shortcodes in the
            past:
          </p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="html"
              data-theme="dark"
            ><code data-language="html" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #908CAA; font-style: italic">&#x3C;!--</span><span style="color: #6E6A86; font-style: italic"> layouts/shortcodes/notice.html </span><span style="color: #908CAA; font-style: italic">--></span></span>
<span data-line=""><span style="color: #6E6A86">&#x3C;</span><span style="color: #9CCFD8">div</span><span style="color: #E0DEF4"> </span><span style="color: #C4A7E7; font-style: italic">class</span><span style="color: #908CAA">=</span><span style="color: #F6C177">"notice"</span><span style="color: #6E6A86">></span></span>
<span data-line=""><span style="color: #E0DEF4">  </span><span style="color: #6E6A86">&#x3C;</span><span style="color: #9CCFD8">h3</span><span style="color: #6E6A86">></span><span style="color: #E0DEF4">{{ .Get "title" }}</span><span style="color: #6E6A86">&#x3C;/</span><span style="color: #9CCFD8">h3</span><span style="color: #6E6A86">></span></span>
<span data-line=""><span style="color: #E0DEF4">  {{ .Inner }}</span></span>
<span data-line=""><span style="color: #6E6A86">&#x3C;/</span><span style="color: #9CCFD8">div</span><span style="color: #6E6A86">></span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #908CAA; font-style: italic">&#x3C;!--</span><span style="color: #6E6A86; font-style: italic"> content/blog/example-post.md </span><span style="color: #908CAA; font-style: italic">--></span></span>
<span data-line=""><span style="color: #E0DEF4"># This is an example post</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #E0DEF4">{{ notice title="This is a notice" }}</span></span>
<span data-line=""><span style="color: #E0DEF4">This is the content inside of a notice shortcode</span></span>
<span data-line=""><span style="color: #E0DEF4">{{ /notice }}</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="html"
              data-theme="light"
            ><code data-language="html" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #797593; font-style: italic">&#x3C;!--</span><span style="color: #9893A5; font-style: italic"> layouts/shortcodes/notice.html </span><span style="color: #797593; font-style: italic">--></span></span>
<span data-line=""><span style="color: #9893A5">&#x3C;</span><span style="color: #56949F">div</span><span style="color: #575279"> </span><span style="color: #907AA9; font-style: italic">class</span><span style="color: #797593">=</span><span style="color: #EA9D34">"notice"</span><span style="color: #9893A5">></span></span>
<span data-line=""><span style="color: #575279">  </span><span style="color: #9893A5">&#x3C;</span><span style="color: #56949F">h3</span><span style="color: #9893A5">></span><span style="color: #575279">{{ .Get "title" }}</span><span style="color: #9893A5">&#x3C;/</span><span style="color: #56949F">h3</span><span style="color: #9893A5">></span></span>
<span data-line=""><span style="color: #575279">  {{ .Inner }}</span></span>
<span data-line=""><span style="color: #9893A5">&#x3C;/</span><span style="color: #56949F">div</span><span style="color: #9893A5">></span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #797593; font-style: italic">&#x3C;!--</span><span style="color: #9893A5; font-style: italic"> content/blog/example-post.md </span><span style="color: #797593; font-style: italic">--></span></span>
<span data-line=""><span style="color: #575279"># This is an example post</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #575279">{{ notice title="This is a notice" }}</span></span>
<span data-line=""><span style="color: #575279">This is the content inside of a notice shortcode</span></span>
<span data-line=""><span style="color: #575279">{{ /notice }}</span></span></code></pre>
          </div>
          <p>
            <sup
              >Minor caveat with shortcode syntax<sup
                ><a
                  href="#user-content-fn-syntax"
                  id="user-content-fnref-syntax"
                  data-footnote-ref
                  aria-describedby="footnote-label"
                  >1</a
                ></sup
              ></sup
            >
          </p>
          <p>
            As you can see, the shortcode internals live in your <code>layouts</code> folder, and have access to your
            <code>page</code> context as well as all of the various Hugo functions. Your post is only able to pass
            parameters into the shortcode itself.
          </p>
          <p>
            Now to be clear, there's absolutely nothing wrong with doing this. In principle, it's a good idea for your
            content to not have any awareness of how it's being rendered. If you were to change the internals of the
            notice shortcode once, all of the pages it appears in are instantly updated upon the next render.
          </p>
          <p>In saying that, the introduction of inline shortcodes allows us to do some fun things:</p>
          <div data-rehype-pretty-code-fragment="">
            <pre
              class="rose-pine-moon"
              style="background-color: #232136"
              tabindex="0"
              data-language="html"
              data-theme="dark"
            ><code data-language="html" data-theme="dark" style="display: grid;"><span data-line=""><span style="color: #908CAA; font-style: italic">&#x3C;!--</span><span style="color: #6E6A86; font-style: italic"> content/blog/example-post.md </span><span style="color: #908CAA; font-style: italic">--></span></span>
<span data-line=""><span style="color: #E0DEF4"># This is an example post</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #E0DEF4">Check out some of these funny gags I wrote:</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #E0DEF4">{{ readfile.inline }}</span></span>
<span data-line=""><span style="color: #6E6A86">&#x3C;</span><span style="color: #9CCFD8">ul</span><span style="color: #6E6A86">></span></span>
<span data-line=""><span style="color: #E0DEF4">{{ range $.Site.Data.gags }}</span></span>
<span data-line=""><span style="color: #6E6A86">&#x3C;</span><span style="color: #9CCFD8">li</span><span style="color: #6E6A86">></span><span style="color: #E0DEF4">{{ . }}</span><span style="color: #6E6A86">&#x3C;/</span><span style="color: #9CCFD8">li</span><span style="color: #6E6A86">></span></span>
<span data-line=""><span style="color: #E0DEF4">{{ end }}</span></span>
<span data-line=""><span style="color: #6E6A86">&#x3C;/</span><span style="color: #9CCFD8">ul</span><span style="color: #6E6A86">></span></span>
<span data-line=""><span style="color: #E0DEF4">{{ /readfile.inline }}</span></span></code></pre>
            <pre
              class="rose-pine-dawn"
              style="background-color: #faf4ed"
              tabindex="0"
              data-language="html"
              data-theme="light"
            ><code data-language="html" data-theme="light" style="display: grid;"><span data-line=""><span style="color: #797593; font-style: italic">&#x3C;!--</span><span style="color: #9893A5; font-style: italic"> content/blog/example-post.md </span><span style="color: #797593; font-style: italic">--></span></span>
<span data-line=""><span style="color: #575279"># This is an example post</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #575279">Check out some of these funny gags I wrote:</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color: #575279">{{ readfile.inline }}</span></span>
<span data-line=""><span style="color: #9893A5">&#x3C;</span><span style="color: #56949F">ul</span><span style="color: #9893A5">></span></span>
<span data-line=""><span style="color: #575279">{{ range $.Site.Data.gags }}</span></span>
<span data-line=""><span style="color: #9893A5">&#x3C;</span><span style="color: #56949F">li</span><span style="color: #9893A5">></span><span style="color: #575279">{{ . }}</span><span style="color: #9893A5">&#x3C;/</span><span style="color: #56949F">li</span><span style="color: #9893A5">></span></span>
<span data-line=""><span style="color: #575279">{{ end }}</span></span>
<span data-line=""><span style="color: #9893A5">&#x3C;/</span><span style="color: #56949F">ul</span><span style="color: #9893A5">></span></span>
<span data-line=""><span style="color: #575279">{{ /readfile.inline }}</span></span></code></pre>
          </div>
          <p>
            <sup
              >Minor caveat with shortcode syntax<sup
                ><a
                  href="#user-content-fn-syntax"
                  id="user-content-fnref-syntax-2"
                  data-footnote-ref
                  aria-describedby="footnote-label"
                  >1</a
                ></sup
              ></sup
            >
          </p>
          <p>Don't believe me? Here's that same inline shortcode embedded in this very post:</p>
          <details>
            <summary>Check out these fun gag lines I wrote</summary>
            {{< readfile.inline >}}
            <ul>
              {{ range $.Site.Data.gags }}
              <li>{{ . }}</li>
              {{ end }}
            </ul>
            {{< /readfile.inline >}}
          </details>
          <p>
            If any of these look familiar, I just used an inline shortcode to read from the same file that powers the
            footer.
          </p>
          <p>
            I haven't used inline shortcodes to their full potential yet but I'd like to use it to add a bit more
            flavour to posts in future where having a dedicated shortcode would be a bit overkill.
          </p>
          <p>They'll always have their place of course! Pick the right tool for the job and all that.</p>
          <p>Anyway, that brings me to the actual topic at hand: debug reports.</p>
          <h2 id="let-hugo-debug-itself-for-you">
            <a aria-hidden="true" class="jumplink" tabindex="-1" href="#let-hugo-debug-itself-for-you">¶ </a>Let Hugo
            debug itself for you
          </h2>
          <p>
            There are always some unknowns to any site like "Do any links throw a 404?" or "Are there posts without a
            description?" and to shed some light on the current situation, we can get a bit meta.
          </p>
          <p>
            It's easiest if you just check out the <a href="/debug">debug</a> section of my site for yourself but the
            short version is that I've been using inline shortcodes to write one off custom reports, that effectively
            answer these questions through introspection. That's just a fancy way of saying I write Hugo content
            (reports) that show the status of other Hugo content.
          </p>
          <p>
            There isn't anything super complex at the moment but I used it to clean up posts where the
            <a href="https://utf9k.net/debug/file-url-match/">folder names didn't match slugs</a> as an example.
          </p>
          <p>
            They automatically update every time the site rebuilds so while I could keep a spreadsheet, this is a nice
            way of keeping that useful information close to where the action happens.
          </p>
          <p>
            I made <a href="https://utf9k.net/debug/reports-todo/">a list of various reports</a> that I'll consider
            generating going forward and some will be a bit more tricky than others.
          </p>
          <p>
            In all likelihood, the most interesting ones will just be reading from data sources generated by external
            scripts running either locally or via a CI pipeline. It's nicer to see all this information on one place
            even if I could just read the logs from my terminal or a pipeline run.
          </p>
          <p>
            Ah, and before I forget, the actual source for the reports
            <a href="https://github.com/marcus-crane/utf9k/tree/main/content/debug">is visible on Github</a> so feel
            free to borrow anything you'd like to use for your own site. They're pretty naively written but they get the
            job done.
          </p>
          <p>
            Hopefully I've given you something to consider and if you think of any interesting report types that aren't
            on my list, <a href="mailto:hello@utf9k.net">I'd love to hear about them!</a>
          </p>
          <section data-footnotes class="footnotes">
            <h2 class="sr-only littlefoot--print" id="footnote-label">
              <a aria-hidden="true" class="jumplink" tabindex="-1" href="#footnote-label">¶ </a>Footnotes
            </h2>
            <ol>
              <li id="user-content-fn-syntax">
                <p>
                  The above isn't actual syntax but near enough. If I were to type it properly, the shortcode would
                  really render, whereas I'm trying to demonstrate the shortcode internals themselves. To find some real
                  shortcode syntax, check out
                  <a href="https://gohugo.io/templates/shortcode-templates/">this</a> section of the Hugo docs.
                  <a
                    href="#user-content-fnref-syntax"
                    data-footnote-backref=""
                    aria-label="Back to reference 1"
                    class="data-footnote-backref"
                    >↩</a
                  >
                  <a
                    href="#user-content-fnref-syntax-2"
                    data-footnote-backref=""
                    aria-label="Back to reference 1-2"
                    class="data-footnote-backref"
                    >↩<sup>2</sup></a
                  >
                </p>
              </li>
            </ol>
          </section>
        </div>
      </article>

      <script src="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.js" type="text/javascript"></script>
      <script type="text/javascript">
        littlefoot.littlefoot(); // Pass any littlefoot settings here.
      </script>
    </div>
    <div id="fullscreen"></div>
    <script type="module">
      import "/js/image-viewer.js";
    </script>
  </body>
</html>

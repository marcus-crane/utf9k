<!DOCTYPE html>
<html><head><meta property="og:type" content="website">
<meta property="og:url" content="http://localhost:3000/blog/-multiple-git-hosts/">
<meta name="twitter:card" content="summary">
</head><body><p>{{% notice title="Some things have changed since I first wrote this" %}}
At the time of writing, I was using Gitlab so you'll see references to my dotfiles living there.</p>
<p {%="" notice="" %="">I've now moved back to Github but kept the references to Gitlab in this post intact.</p>
<p>When using my work laptop, I like to keep a copy of my dotfiles so that my tools at work are in sync with my tools at home. They <a href="https://github.com/marcus-crane/dotfiles">live in a Github repository</a> under my personal account, and I use plain old git to sync changes.</p>
<p>In order to push and pull changes from Github, I use an SSH key rather than a password. It's easy enough to generate one of course but I also have one for the internal repository at my work. Juggling the two can sometimes be annoying when setting up a fresh laptop without some proper configuration.</p>
<p>Usually I forget what that looks like so here's a quick walkthrough on how you too can juggle multiple git hosts.</p>
<p>Let's have a look at a barebones ssh configuration file:</p>
<pre><code class="language-shell hljs"><span class="hljs-meta prompt_">&gt; </span><span class="language-bash"><span class="hljs-built_in">cat</span> ~/.ssh/config</span>
Host github.example.com
  IdentityFile ~/.ssh/work

Host gitlab.com
  IdentityFile ~/.ssh/personal

Host github.com
  IdentityFile ~/.ssh/personal
</code></pre>
<p>We've got three different hosts and two different SSH keys.</p>
<p>Whenever you use <code>ssh</code>, it'll check to see if you have any host blocks defined. If they match the host provided, it'll use the corresponding configuration.</p>
<p>Let's see how it looks in action:</p>
<pre><code class="language-shell hljs"><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">ssh -T git@github.example.com</span>
Hi marcus! You've successfully authenticated, but GitHub does not provide shell access.
<span class="hljs-meta prompt_">&gt; </span><span class="language-bash">ssh -T git@gitlab.com</span>
Welcome to GitLab, @marcus-crane!
</code></pre>
<p>The connection to <code>github.example.com</code> uses the key stored at <code>~/.ssh/work</code>, while the connection to <code>gitlab.com</code> has used the key stored at <code>~/.ssh/personal</code>. Perfect!</p>
<p>You can also add additional configuration that is specific to just one host.</p>
<p>Let's look at an example with a few more options:</p>
<pre><code class="language-shell hljs"><span class="hljs-meta prompt_">&gt; </span><span class="language-bash"><span class="hljs-built_in">cat</span> ~/.ssh/config</span>
Host github.example.com
  IdentityFile ~/.ssh/work

Host gitlab.com
  IdentityFile ~/.ssh/personal
  LogLevel VERBOSE

Host github.com
  HostName notarealuser
  IdentityFile ~/.ssh/personal
</code></pre>
<p>It's mostly the same with two new commands <code>LogLevel</code> and <code>HostName</code>. Let's see it in action once again before we dive a bit deeper:</p>
<pre><code class="language-shell hljs"><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">ssh -T git@github.com</span>
ssh: Could not resolve hostname notarealuser: Name or service not known
<span class="hljs-meta prompt_">&gt; </span><span class="language-bash">ssh -T git@gitlab.com</span>
Authenticated to gitlab.com ([35.231.145.151]:22).
Welcome to GitLab, @marcus-crane!
Transferred: sent 2036, received 3072 bytes, in 0.5 seconds
Bytes per second: sent 4366.6, received 6588.4
</code></pre>
<p>We can see that we sent a request to <code>github.com</code> and it interpreted the corresponding host block, attempting to log in as someone called <code>notarealuser</code>.</p>
<p>For most git servers, the user will default to <code>git</code> and is generally part of your remote anyway. You can see it whenever you run <code>git remote add origin git@github.com/user/blah</code> or <code>git remote -v</code>.</p>
<p>It can be quite handy for regular servers however. Instead of connecting with <code>ssh user@blah.net</code>, you can add the username to a host block and shorten that command down to just <code>ssh blah.net</code></p>
<p>The <code>LogLevel</code> command is fairly straight forward. You can set it to a higher level of logging, and see more details about what SSH is doing under the hood, but for a specific host.</p>
<p>If you're getting error messages from your internal git host, you could toggle on <code>LogLevel DEBUG</code> and see if your requests are making their way to the host or not as an example.</p>
<p>I'm sure there's all sorts of interesting stuff you could do but this post isn't meant to be comprehensive by any means. It's more of a reminder to myself on how to create an ssh config file.</p>
<p>You can see all of the various commands offline by running <code>man ssh_config</code>. You can also read them online via the <a href="https://man.openbsd.org/ssh_config">OpenBSD manual page server</a>.</p>
<p>Happy SSHing!</p>
</body></html>
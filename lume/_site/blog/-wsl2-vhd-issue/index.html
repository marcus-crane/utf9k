<!DOCTYPE html>
<html><head><meta property="og:type" content="website">
<meta property="og:url" content="http://localhost:3000/blog/-wsl2-vhd-issue/">
<meta name="twitter:card" content="summary">
</head><body><p>I recently started running the Windows Insider builds on my desktop so that I could play around with the new Windows Subsystem for Linux but I ran into some trouble. Before I get into the fix, here's a little bit of history</p>
<h2>The history</h2>
<p>For the unfamiliar, it's a way to run Linux applications inside of a Windows environment using a lightweight VM.</p>
<p>For the familiar, you may have heard of WSL 1, which essentially translated Linux system calls into their appropriate NT kernel counterparts. The downside meant that things were kind of slow, and not everything worked as you would hope.</p>
<p>The biggest downside was perhaps USB devices, in that there were no drivers to support them. Personally, I was unable to use the Yubikey NEO I had at the time, given that <a href="https://github.com/microsoft/WSL/issues/1521">smart cards had no support</a>. Anyone using USB debug interfaces such as <a href="https://github.com/microsoft/WSL/issues/2185">JTAG</a> or <a href="https://github.com/microsoft/WSL/issues/2195">ADB</a> was out of luck too.</p>
<p>Thankfully, this should hopefully be in the past now with the <a href="https://devblogs.microsoft.com/commandline/announcing-wsl-2">announcement of WSL 2</a>, a virtual machine that's supposed to be so light, it's not like those other slow virtual machines you think of.</p>
<h2>The fix</h2>
<p>Long story short, I dove in by following the installation instructions and hit a brick wall once I got to the second step.</p>
<pre><code class="language-powershell hljs"><span class="hljs-built_in">PS</span> C:\WINDOWS\system32&gt; wsl <span class="hljs-literal">--set-version</span> Ubuntu <span class="hljs-number">2</span>
Conversion <span class="hljs-keyword">in</span> progress, this may take a few minutes...
<span class="hljs-keyword">For</span> information on key differences with WSL <span class="hljs-number">2</span> please visit https://aka.ms/wsl2
The requested operation could not be completed due to a virtual disk system limitation.
Virtual hard disk files must be uncompressed and unencrypted and must not be sparse.
</code></pre>
<p>Upon trying to convert my WSL distros to Version 2, they complained about a virtual disk system limitation. I actually put this on the backburner for months until coming back to it today and the fix felt dumb.</p>
<p>You'd never know it but your WSL packages live under <code>%LOCALAPPDATA%/packages/&lt;distro title surrounded by nonsense&gt;</code>. In my case, Debian lives at <code>C:\Users\Marcus\AppData\Local\Packages\TheDebianProject.DebianGNULinux_76v4gfsz19hv4</code>. If you visit your distro's respective folder, you'll find no virtual disk image in sight.</p>
<p>The terms "uncompressed and unencrypted" tipped me off to check those blasted "advanced settings". Under <code>Right Click -&gt; Properties -&gt; General -&gt; Advanced</code>, I spotted <code>Compress contents to save disk space</code> was ticked for some reason. Unchecking it, then rerunning the WSL 1 -&gt; 2 conversion worked as you'd hope.</p>
<p><img src="compressed.png" alt="A screenshot showing Windows Explorer. It is open to C:/Users/Marcus/AppData/Local/Packages. A folder is highlighted to indicate it was recently clicked on. The properties window for that folder is visible showing metadata. Overlaying the properties window is the Advanced Attributes window where a checkbox labelled 'Compress contents to save disk space' is checked. The author is showing that you should uncheck that box to fix the issue described in this post."></p>
<p>So, if you run into this issue, have a poke around your packages and hopefully you'll be on your way to a nice, properly Linux-y home on Windows.</p>
</body></html>